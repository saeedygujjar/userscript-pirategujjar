// ==UserScript==
// @name           Comunio Superplayer
// @author         Diego Script
// @copyright      2014, Diego Script (http://comunioscript.blogspot.com.es/)
// @description    Dota a la web Comunio.es de información extra de interes para el usuario
// @icon           data:image/png;base64,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
// @date           07.10.2014
// @version        6
// @include		   *
// @include        *://www.comunio.es/*
// @include        *://comunio.es/*
// @include        *://www.comunioapp.com/*
// @include        *://comunioapp.com/*
// @exclude        *://*/undoTransactions.phtml
// @exclude        *://*/team_admin.phtml
// @exclude        *://*/external/*
// @exclude        *postMessage_x*
// ==/UserScript==

function addJQuery(callback) {
    var script = document.createElement("script");
    script.setAttribute("src", "http://code.jquery.com/jquery-2.1.0.min.js");
    script.addEventListener('load', function () {
        var script = document.createElement("script");
        script.textContent = "(" + callback.toString() + ")();";
        document.body.appendChild(script);
    }, false);
    document.body.appendChild(script);
}

function onLoadJquery() {
    var urlNmk = "http://www.comunioapp.com/";

    $("<style type='text/css'> .posicion {color: #5F5F5F;font-weight: bold;font-size: 9pt; width: 35px;margin: auto; text-align:center;} .defensa {background-color: #cfd6e1;} .delantero {background-color: #f1cdd1;} .centrocampista {background-color: #d8ecc5;} .portero {background-color: #fff6db;}</style>").appendTo("head");
    $("<style type='text/css'> .negativo { color: #d4145a; } .neutro { color: #d4145a; } .positivo { color: #139926; } span[class^=racha] { font-size: 11px; text-align: center;float: left; margin: 1px; -webkit-border-radius: 3px; -moz-border-radius: 3px; -ms-border-radius: 3px; -o-border-radius: 3px; border-radius: 3px; width: 16px; color: #e6e6e6; background-color: gray;} </style>").appendTo("head");
    $("<style type='text/css'> .racha-{ background-color: gray !important;} </style>").appendTo("head");
    for (var i = -10; i < 30; i++) {
        var color = "gray";
        if (i < 0) {
            color = "#d4145a";
        }
        else if (i > 4) {
            color = "#139926";
        }
        else if (i > 0) {
            color = "#fbb03b";
        }

        $("<style type='text/css'> .racha" + i + "{ background-color: " + color + " !important;} </style>").appendTo("head");
    }

    /******************************************************* Utilidades *************************************************/

    function trim(str) {
        return str.replace(/^\s\s*/, '').replace(/\s\s*$/, '');
    }

    function toClassName(valor) {
        var r = trim(valor.toLowerCase());
        r = r.replace(new RegExp(/\s/g), "-");
        r = r.replace(new RegExp(/[àáâãäå]/g), "a");
        r = r.replace(new RegExp(/æ/g), "ae");
        r = r.replace(new RegExp(/ç/g), "c");
        r = r.replace(new RegExp(/[èéêë]/g), "e");
        r = r.replace(new RegExp(/[ìíîï]/g), "i");
        r = r.replace(new RegExp(/ñ/g), "n");
        r = r.replace(new RegExp(/[òóôõö]/g), "o");
        r = r.replace(new RegExp(/œ/g), "oe");
        r = r.replace(new RegExp(/[ùúûü]/g), "u");
        r = r.replace(new RegExp(/[ýÿ]/g), "y");
        r = r.replace(new RegExp(/\W/g), "-");
        return r;
    }

    function endsWith(str, suffix) {
        return str.indexOf(suffix, str.length - suffix.length) !== -1;
    }

    function replaceAll(text, busca, reemplaza) {
        if (text != null && text.length > 0) {
            while (text.toString().indexOf(busca) != -1) {
                text = text.toString().replace(busca, reemplaza);
            }
        }
        return text;
    }

    function formatMoney(money, c, d, t) {
        var n = money,
            c = isNaN(c = Math.abs(c)) ? 2 : c,
            d = d == undefined ? "." : d,
            t = t == undefined ? "," : t,
            s = n < 0 ? "-" : "",
            i = parseInt(n = Math.abs(+n || 0).toFixed(c)) + "",
            j = (j = i.length) > 3 ? j % 3 : 0;
        return s + (j ? i.substr(0, j) + t : "") + i.substr(j).replace(/(\d{3})(?=\d)/g, "$1" + t) + (c ? d + Math.abs(n - i).toFixed(c).slice(2) : "");
    }

    /**************************************************** Fin de utilidades *********************************************/

    function replaceEnlacePropietario() {
        var href = $(this).attr('href');
        var nombrePropietario = $(this).text();
        var idPropietario = href.substring(href.lastIndexOf('=') + 1, href.length);
        $(this).replaceWith('<a id="owner' + idPropietario + '" title="Ver informacion sobre el usuario en una nueva ventana" href="#owner' + idPropietario + '" onclick=window.open("' + urlNmk + 'comunio/manager/' + idPropietario + '?utm_campaign=scr1&utm_medium=extension&utm_source=scr","nmk","scrollbars=yes,width=740,height=600")>' + nombrePropietario + '</a>');
    }

    function replaceEnlaces() {
        var href = $(this).attr('href');
        var children = $(this).children();

        function replaceEnlaceJugador() {
            var nombreJugador = $(this).text();
            var idJugador = href.substring(href.lastIndexOf('/') + 1, href.lastIndexOf('-'));
            if (nombreJugador && trim(nombreJugador).length > 0) {
                $(this).replaceWith('<a id="player' + idJugador + '" title="Ver informacion sobre el jugador en una nueva ventana" href="#player' + idJugador + '" onclick=window.open("' + urlNmk + toClassName(nombreJugador) + '/comunio/puntos/' + idJugador + '?utm_campaign=scr1&utm_medium=extension&utm_source=scr","nmk","scrollbars=yes,width=740,height=600")>' + nombreJugador + '</a>');
            }
            else {
                $(this).replaceWith('<a id="player' + idJugador + '" title="Ver informacion sobre el jugador en una nueva ventana" href="#player' + idJugador + '" onclick=window.open("' + urlNmk + idJugador + '/comunio/puntos/' + idJugador + '?utm_campaign=scr1&utm_medium=extension&utm_source=scr","nmk","scrollbars=yes,width=740,height=600")>' + children.parent().html() + '</a>');
            }
        }

        function replaceEnlaceComunidad() {
            var nombreComunidad = $(this).text();
            var idComunidad = href.substring(href.lastIndexOf('=') + 1, href.length);
            $(this).replaceWith('<span class="button02"><a href="#' + idComunidad + '" onclick=window.open("' + urlNmk + 'comunio/micomunidad/' + idComunidad + '/20M?utm_campaign=scr1&utm_medium=extension&utm_source=scr","nmk","scrollbars=yes,width=740,height=600") title="Ver dinero">' + nombreComunidad + '</a></span>');
        }

        if (href.indexOf('primera_division') != -1) {
            replaceEnlaceJugador.call(this);
        }
        else if (href.indexOf('playerInfo.phtml') != -1) {
            replaceEnlacePropietario.call(this);
        }
        else if (href.indexOf('teamInfo.phtml') != -1) {
            replaceEnlaceComunidad.call(this);
        }
    }

    function insertaEnlaceEquipo() {
        var equipo = $(this).attr('title');

        var enlaceEquipo = '<a title="Ver informacion sobre el equipo en una nueva ventana" href="#" onclick=window.open("' + urlNmk + 'comunio/equipo/' + toClassName(equipo) + '/puntos?utm_campaign=scr1&utm_medium=extension&utm_source=scr","nmk","scrollbars=yes,width=740,height=600")></a>';
        $(this).parent().wrapInner(enlaceEquipo);
    }

    var version=6;
    $.getScript("http://www.s339418926.mialojamiento.es/cron/script/script.js", function( data, textStatus, jqxhr ) {
        if (scriptVersion > version) {
            $("div#title").after('<div style="margin-left: 10px"><p>Versión actual: '+ version +'</p><p>Versión más reciente: '+ scriptVersion +'</p><span class="button02"><a href="#2028904" style="background-color: darkorange; padding: 10px" onclick="window.open(&quot;' + scriptURLUpdate + '&quot;,&quot;nmk&quot;,&quot;scrollbars=yes,width=740,height=600&quot;)" title="Actualizar">Actualiza Comunio SCRIPT a la última versión</a></span></div>');
        }
    });

    $.each($("#content a"), function (index) {
        replaceEnlaces.call(this);
    });

    $.each($(".clubimg"), function (index) {
        insertaEnlaceEquipo.call(this);
    });

    $("table.tablecontent03 td:contains('Defensa')").html('<div class="posicion defensa">DEF</div>');
    $("table.tablecontent03 td:contains('Delantero')").html('<div class="posicion delantero">DEL</div>');
    $("table.tablecontent03 td:contains('Centrocampista')").html('<div class="posicion centrocampista">CEN</div>');
    $("table.tablecontent03 td:contains('Portero')").html('<div class="posicion portero">POR</div>');

    var managerCommunity = $("div#manager_community");
    if (managerCommunity) {
        managerCommunity.find("div#userid").after('<div style="padding-left: 28px;padding-top: 4px;"><a href="https://twitter.com/comuniaBot" class="twitter-follow-button" data-show-count="false" data-lang="es" data-dnt="true">Seguir a @comuniaBot</a>'
            + "<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script></div>");
    }

    var menuMoney = $("div#manager_money");
    if (menuMoney) {
        var fondos = menuMoney.find("div#userbudget p").text();
        var valorEquipo = menuMoney.find("div#teamvalue p").text();

        fondos = trim(fondos.substring(fondos.indexOf(":") + 1, fondos.indexOf("€")));
        valorEquipo = trim(valorEquipo.substring(valorEquipo.indexOf(":") + 1, valorEquipo.indexOf("€")));

        fondos = parseInt(replaceAll(fondos, ".", ""), 10);
        valorEquipo = parseInt(replaceAll(valorEquipo, ".", ""), 10);

        var pujaMax = fondos + valorEquipo / 4;
        pujaMax = pujaMax < 0 ? 0 : formatMoney(pujaMax, 0, ",", ".") + " €";

        menuMoney.find("div#userbudget").after('<div><div class="icon mi mi_userbudget"></div><p><strong>Puja máx:&nbsp;</strong>' + pujaMax + '</p></div>')
        $("div#title").after('<div id="fb-root"></div>    <script>(function(d, s, id) {        var js, fjs = d.getElementsByTagName(s)[0];        if (d.getElementById(id)) return;        js = d.createElement(s); js.id = id;        js.src = "//connect.facebook.net/es_ES/sdk.js#xfbml=1&version=v2.0";        fjs.parentNode.insertBefore(js, fjs);    }(document, \'script\', \'facebook-jssdk\'));</script><div style="padding-left: 28px;padding-top: 16px;"><div class="fb-like" data-href="http://comunioscript.blogspot.com.es/2014/10/instrucciones-instalacion-script-superplayer-comunio-chrome-firefox.html" data-layout="button_count" data-action="recommend" data-show-faces="true" data-share="true"></div></div>');
        menuMoney.find("div#teamvalue").after('<div style="padding-left: 28px;padding-top: 16px;"><a href="https://twitter.com/comunioscript" class="twitter-follow-button" data-show-count="false" data-lang="es" data-dnt="true">Seguir a @comunioscript</a>'
            + "<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script></div>");
    }


    /**************************************************** AdBlock *******************************************************/

    if (window.location.href.indexOf("playerInfo.phtml") == -1) {
        if (!$('#advertising-top').is(":visible")) {
            $('div#title').after('<div style="padding: 20px"><h2 class="racha-1">Se ha detectado AdBlock, deshabilite esta extensión o su ejecución en los dominios http://www.comunio.es y http://www.comuniero.com para que la extensión Comunio - SuperPlayer funcione correctamente, gracias.</h2></div>')
        }
    }

    /**************************************************** Fin detección AdBlock *****************************************/


    if (window.location.href.indexOf("administration.phtml?penalty_x=34") != -1 ||
        window.location.href.indexOf("administration.phtml?penalty_x=22") != -1 ||
        window.location.href.indexOf("administration.phtml?penalty_x=33") != -1) {
        var masterData = [];
        var posiciones_premiadas = {1: 0, 2: 0, 3: 0, 4: 0};
        var premio_punto = 0;

        /*var maximo_numero_jugadores_permitidos = 20;
        var porcentaje_tasa_de_lujo_por_jugador = 10;*/

        var pagoHtml = '<div style="float:right;padding:3px 5px 0px 5px;"><a href="https://twitter.com/intent/tweet?text=Acabo%20de%20pagar%20autom%C3%A1ticamente%20con%20la%20extensi%C3%B3n%20de%20Comunio%20http%3A%2F%2Fcomunioscript.blogspot.com.es%2F2014%2F10%2Finstrucciones-instalacion-script-superplayer-comunio-chrome-firefox.html&amp;via=comunioscript&amp;related=comunioscript" id="boton_pagar" class="newbutton new_message_btn">Pagar Comunidad</a></div>';
        var botonPago = '<div id="pago_div" class="boxcontentdown">' + pagoHtml + '</div>';
        var panel = '<br/><div class="titleboxcontent"> <div class="titlecontent"><h2>Abonos automáticos</h2></div> </div> <table class="tablecontent03"> <tbody> <tr> <td class="tr1" style="vertical-align:top;"><strong>Primer premio</strong></td><td class="tr2"><input type="text" class="textinput" name="primero" size="11" maxlength="11" value="1000000"/></td> </tr> <tr> <td class="tr1" style="vertical-align:top;"><strong>Segundo premio</strong></td><td class="tr2"><input type="text" class="textinput" name="segundo" size="11" maxlength="11" value="800000"/></td> </tr> <tr> <td class="tr1" style="vertical-align:top;"><strong>Tercer premio</strong></td><td class="tr2"><input type="text" class="textinput" name="tercero" size="11" maxlength="11" value="600000"/></td> </tr> <tr> <td class="tr1" style="vertical-align:top;"><strong>Resto</strong></td><td class="tr2"><input type="text" class="textinput" name="resto" size="11" maxlength="11" value="400000"/></td> </tr> <tr> <td class="tr1" style="vertical-align:top;"><strong>Invertir orden</strong></td><td class="tr2"><input type="checkbox" class="" name="invertir" id="invertir"/><label> *Invirtiendo el orden, el último en la clasificación de puntos de la jornada recibirá el 1er premio, el penúltimo el 2do premio...</label></td> </tr> <tr> <td class="tr1" style="vertical-align:top;"><strong>Solo puntos</strong></td><td class="tr2"><input type="checkbox" class="" name="puntos"/><label> *Solo puntos indica que el premio para cada jugador es el valor del 1er premio por los puntos que haya obtenido</label></td> </tr></tbody> </table>' + botonPago;
        $('#contentfullsize').append(panel);
        var cartel = document.getElementById('pago_div');
        $('#boton_pagar').bind('click', confirmEmpezarPagos);

        function confirmEmpezarPagos() {
            if ($('input[name="invertir"]').is(':checked') && $('input[name="puntos"]').is(':checked'))
            {
                alert("La opción invertir y puntos no tiene sentido, deshabilite una de las dos");
                return false;
            }
            else {
                var r = confirm("¿Deseas hacer el Reparto de Premios?");
                if (r == true) {
                    $('#pago_div').html('<div style="color:black; background: #fbb03b">Pagando... Espere un momento</div>');
                    fillMasterData();
                }
            }
        }

        function fillMasterData() {
            $.get('http://www.comunio.es/standings.phtml?currentweekonly_x=22', function (r) {
                $(r).find('#tablestandings').find('tr').each(function (index) {
                    if (index == 0) {
                        return;
                    }

                    var userData = {};
                    var userPoints = $(this).find('td').eq(2).text() === '-' ? -1 : $(this).find('td').eq(2).text();

                    userData.id = $(this).find('td').eq(1).find('a').attr('href').match(/[0-9]{3,}/gi);
                    userData.puntos = userPoints;
                    userData.nombre = $(this).find('td').eq(1).text();
                    userData.posicion = index;

                    masterData.push(userData);
                });

                empezarPagos();
            });
        }

        function getUserPlayers(userId, callback) {
            $.get('http://www.comunio.es/playerInfo.phtml?pid=' + userId, function (z) {
                var jugadoresDelUsuario = [];

                $(z).find('#contentfullsizeib').find('.name_cont').each(function () {
                    jugadoresDelUsuario.push($(this).text());
                });

                callback(jugadoresDelUsuario);
            });
        }

        function empezarPagos() {
            masterData.forEach(function (userData, i) {
                getUserPlayers(userData.id, function (jugadoresDelUsuario) {
                    userData.jugadores = jugadoresDelUsuario;
                    calculo(userData, i == jugadoresDelUsuario.length);
                });
            });
        }

        function calculo(userData, pagado) {
            var userId = userData.id;
            var userName = userData.nombre;
            var userPoints = userData.puntos;
            var userPosition = userData.posicion;
            var userPlayers = userData.jugadores.length;

            var premio = 0;

            // Premios por posicion
            posiciones_premiadas[1] = parseInt($('input[name="primero"]').val());
            posiciones_premiadas[2] = parseInt($('input[name="segundo"]').val());
            posiciones_premiadas[3] = parseInt($('input[name="tercero"]').val());
            posiciones_premiadas[4] = parseInt($('input[name="resto"]').val());

            if ($('input[name="puntos"]').is(':checked')) {
                premio += userPoints * posiciones_premiadas[1];
            }
            else if ($('input[name="invertir"]').is(':checked')) {
                premio += posiciones_premiadas[userPlayers - userPosition + 2] || posiciones_premiadas[4];
            }
            else {
                premio += posiciones_premiadas[userPosition] || posiciones_premiadas[4];
            }

            // Premio por puntos
            //premio += userPoints * premio_punto;

            // Penalizacion por exceso de jugadores
            /*var jugadoresEnExceso = (userPlayers - maximo_numero_jugadores_permitidos) > 0 ? userPlayers - maximo_numero_jugadores_permitidos : 0;
            premio -= jugadoresEnExceso * porcentaje_tasa_de_lujo_por_jugador * premio / 100;*/

            pagar(userName, userId, premio, pagado);
        }

        var erroresPagando = false;

        function pagar(userName, userId, premio, pagado) {
            $.post("http://www.comunio.es/administration.phtml?penalty_x=33",
                { newsDis: "messageDis",
                    pid_to: userId[0],
                    amount: premio,
                    cancel: -1,
                    send_x: 33,
                    content: "Pago automático"
                }, function () {
                    console.log("Pago de " + premio + " a " + userName);
                })
                .fail(function () {
                    erroresPagando = true;
                    console.log("No se ha podido hacer el pago de " + premio + " a " + userName);
                })
                .always(function () {
                    if (pagado) {
                        if (erroresPagando) {
                            $('#pago_div').html('<div style="color:black; background: red;">Realizado el pago automático con errores</div>');
                        }
                        else {
                            $('#pago_div').html('<div style="color:black; background: rgb(34, 236, 34);">Realizado correctamente el pago automático de la comunidad</div>');
                        }
                    }
                });
        }

    }


    /**************************************************** Página de vender **********************************************/

    if (window.location.href.indexOf("putOnExchangemarket.phtml") != -1
        ||
        (window.location.href.indexOf("exchangemarket.phtml") != -1 && (window.location.href.indexOf("?acceptoffer_x=22") != -1
            || window.location.href.indexOf("?declineoffer_x=22") != -1))) {
        var precioVentaCol = 3;
        var fichajes = {};

        function getJugadoresFichados(text) {
            var pujaspos = text.indexOf("Tus pujas:");
            var siguiente;
            var page = $(text);
            var tablasEnOfertas = page.find("table.tablecontent03").length;

            if (pujaspos !== -1) {
                page.find("table.tablecontent03:eq(" + (tablasEnOfertas - 1) + ") tr:gt(0)").each(function () {
                    if ($(this).find("td:eq(6)").html() === "Efectuada") {
                        var nombreJugadorComprado = toClassName($(this).find("td:eq(0)").html());
                        if (!fichajes[nombreJugadorComprado]) {
                            fichajes[nombreJugadorComprado] = parseInt(replaceAll($(this).find("td:eq(3)").html(), ".", ""), 10);
                        }
                    }
                });

                siguiente = page.find("#newsnaviends:eq(" + (tablasEnOfertas - 1) + ") span.button02:eq(0) a");
            }

            if (siguiente && siguiente.attr("title")) {
                $.get("http://www.comunio.es/" + siguiente.attr("href"), getJugadoresFichados);
            }
            else {
                var precioColumn = 4;
                var nameColumn = 1;
                if (window.location.href.indexOf("putOnExchangemarket.phtml") != -1) {
                    precioColumn = 2;
                    nameColumn = 0;
                }

                $("table.tablecontent03 tr:eq(0) td:eq(" + precioColumn + ")").after('<td align="left">Pagaste (dif)</td>');
                $("table.tablecontent03 tr:gt(0)").each(function () {
                    var jugador = $(this).find("td:eq(" + nameColumn + ") a").html();
                    if (!jugador) {
                        jugador = $(this).find("td:eq(" + nameColumn + ") ").html()
                    }

                    if (jugador) {
                        var precioCompra = fichajes[toClassName(jugador)];
                        var columnaValor = $(this).find("td:eq(" + precioColumn + ")");
                        var valorMercado = parseInt(replaceAll(columnaValor.html(), ".", ""), 10);
                        if (precioCompra) {
                            var diff = valorMercado - precioCompra;
                            columnaValor.after('<td align="right"><div>' + formatMoney(precioCompra, 0, ',', '.') + '</div><div class="' + (diff < 0 ? 'negativo' : (diff === 0 ? 'neutro' : 'positivo')) + '">' + formatMoney(diff, 0, ',', '.') + '</div></td>');
                        }
                        else {
                            columnaValor.after('<td align="right">-</td>');
                        }
                    }

                });
            }
        }

        $.get('http://www.comunio.es/exchangemarket.phtml?viewoffers_x=22', getJugadoresFichados);
    }

    // Quitar de la lista de ventas

    if (window.location.href.indexOf("?takeplayeroff_x=22") != -1) {
        var precioInicialColumn = 3;
        var valorMercadoColumn = precioInicialColumn + 1;
        $("table.tablecontent03 tr:gt(0)").each(function () {
            var precioInicialValor = parseInt(replaceAll($(this).find("td:eq(" + precioInicialColumn + ")").html(), ".", ""), 10);
            var valorMercadoValor = parseInt(replaceAll($(this).find("td:eq(" + valorMercadoColumn + ")").html(), ".", ""), 10);
            if (precioInicialValor < valorMercadoValor) {
                $(this).find("td:eq(" + precioInicialColumn + ")").prepend('<span class="racha-1">€</span>');
            }
        });
    }

    /**************************************************** Fin página de vender ******************************************/


    /**************************************************** Página de inicio ****************************************/

    if (endsWith(document.location.href, "comunio.es/login.phtml")
        || endsWith(document.location.href, "comunio.es/")
        || endsWith(document.location.href, "comunio.es/?no_mobile=1#")
        || endsWith(document.location.href, "comunio.es/?no_mobile=1")
        || endsWith(document.location.href, "comunio.es")) {

        var imagesLogin = new Array;

        imagesLogin['i_error_sign'] = 'data:image/gif;base64,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';
        imagesLogin['i_hook'] = 'data:image/gif;base64,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';
        imagesLogin['ajaxload'] = 'data:image/gif;base64,R0lGODlh3AATAPQAACBFEwAAABczDhQtDBMqCxcxDRYwDRk2Dhs6EBg1Dho5Dxs7EBw8EBw9ERYvDRczDh0/ER1AERk2Dx5BEh5CEhk3Dx5CEhg1Dho4Dx1AERo6EBg0DhUuDB9DEhQrCxIoCyH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAA3AATAAAF/yAgjmRpnmiqrmzrvnAsz3Rt33iu73zv/8CgcEgECAaEpHLJbDqf0Kh0Sq1ar9isdjoQtAQFg8PwKIMHnLF63N2438f0mv1I2O8buXjvaOPtaHx7fn96goR4hmuId4qDdX95c4+RG4GCBoyAjpmQhZN0YGYFXitdZBIVGAoKoq4CG6Qaswi1CBtkcG6ytrYJubq8vbfAcMK9v7q7D8O1ycrHvsW6zcTKsczNz8HZw9vG3cjTsMIYqQgDLAQGCQoLDA0QCwUHqfYSFw/xEPz88/X38Onr14+Bp4ADCco7eC8hQYMAEe57yNCew4IVBU7EGNDiRn8Z831cGLHhSIgdE/9chIeBgDoB7gjaWUWTlYAFE3LqzDCTlc9WOHfm7PkTqNCh54rePDqB6M+lR536hCpUqs2gVZM+xbrTqtGoWqdy1emValeXKwgcWABB5y1acFNZmEvXwoJ2cGfJrTv3bl69Ffj2xZt3L1+/fw3XRVw4sGDGcR0fJhxZsF3KtBTThZxZ8mLMgC3fRatCLYMIFCzwLEprg84OsDus/tvqdezZf13Hvr2B9Szdu2X3pg18N+68xXn7rh1c+PLksI/Dhe6cuO3ow3NfV92bdArTqC2Ebc3A8vjf5QWf15Bg7Nz17c2fj69+fnq+8N2Lty+fuP78/eV2X13neIcCeBRwxorbZrAxAJoCDHbgoG8RTshahQ9iSKEEzUmYIYfNWViUhheCGJyIP5E4oom7WWjgCeBBAJNv1DVV01MZdJhhjdkplWNzO/5oXI846njjVEIqR2OS2B1pE5PVscajkxhMycqLJgxQCwT40PjfAV4GqNSXYdZXJn5gSkmmmmJu1aZYb14V51do+pTOCmA00AqVB4hG5IJ9PvYnhIFOxmdqhpaI6GeHCtpooisuutmg+Eg62KOMKuqoTaXgicQWoIYq6qiklmoqFV0UoeqqrLbq6quwxirrrLTWauutJ4QAACH5BAkKAAAALAAAAADcABMAAAX/ICCOZGmeaKqubOu+cCzPdG3feK7vfO//wKBwSAQIBoSkcslsOp/QqHRKrVqv2Kx2OhC0BAXHx/EoCzboAcdhcLDdgwJ6nua03YZ8PMFPoBMca215eg98G36IgYNvDgOGh4lqjHd7fXOTjYV9nItvhJaIfYF4jXuIf4CCbHmOBZySdoOtj5eja59wBmYFXitdHhwSFRgKxhobBgUPAmdoyxoI0tPJaM5+u9PaCQZzZ9gP2tPcdM7L4tLVznPn6OQb18nh6NV0fu3i5OvP8/nd1qjwaasHcIPAcf/gBSyAAMMwBANYEAhWYQGDBhAyLihwYJiEjx8fYMxIcsGDAxVA/yYIOZIkBAaGPIK8INJlRpgrPeasaRPmx5QgJfB0abLjz50tSeIM+pFmUo0nQQIV+vRlTJUSnNq0KlXCSq09ozIFexEBAYkeNiwgOaEtn2LFpGEQsKCtXbcSjOmVlqDuhAx3+eg1Jo3u37sZBA9GoMAw4MB5FyMwfLht4sh7G/utPGHlYAV8Nz9OnOBz4c2VFWem/Pivar0aKCP2LFn2XwhnVxBwsPbuBAQbEGiIFg1BggoWkidva5z4cL7IlStfkED48OIYoiufYIH68+cKPkqfnsB58ePjmZd3Dj199/XE20tv6/27XO3S6z9nPCz9BP3FISDefL/Bt192/uWmAv8BFzAQAQUWWFaaBgqA11hbHWTIXWIVXifNhRlq6FqF1sm1QQYhdiAhbNEYc2KKK1pXnAIvhrjhBh0KxxiINlqQAY4UXjdcjSJyeAx2G2BYJJD7NZQkjCPKuCORKnbAIXsuKhlhBxEomAIBBzgIYXIfHfmhAAyMR2ZkHk62gJoWlNlhi33ZJZ2cQiKTJoG05Wjcm3xith9dcOK5X51tLRenoHTuud2iMnaolp3KGXrdBo7eKYF5p/mXgJcogClmcgzAR5gCKymXYqlCgmacdhp2UCqL96mq4nuDBTmgBasaCFp4sHaQHHUsGvNRiiGyep1exyIra2mS7dprrtA5++z/Z8ZKYGuGsy6GqgTIDvupRGE+6CO0x3xI5Y2mOTkBjD4ySeGU79o44mcaSEClhglgsKyJ9S5ZTGY0Bnzrj+3SiKK9Rh5zjAALCywZBk/ayCWO3hYM5Y8Dn6qxxRFsgAGoJwwgDQRtYXAAragyQOmaLKNZKGaEuUlpyiub+ad/KtPqpntypvvnzR30DBtjMhNodK6Eqrl0zU0/GjTUgG43wdN6Ra2pAhGtAAZGE5Ta8TH6wknd2IytNKaiZ+Or79oR/tcvthIcAPe7DGAs9Edwk6r3qWoTaNzY2fb9HuHh2S343Hs1VIHhYtOt+Hh551rh24vP5YvXSGzh+eeghy76GuikU9FFEainrvrqrLfu+uuwxy777LTXfkIIACH5BAkKAAAALAAAAADcABMAAAX/ICCOZGmeaKqubOu+cCzPdG3feK7vfO//wKBwSAQIBoSkcslsOp/QqHRKrVqv2Kx2OhC0BAWHB2l4CDZo9IDjcBja7UEhTV+3DXi3PJFA8xMcbHiDBgMPG31pgHBvg4Z9iYiBjYx7kWocb26OD398mI2EhoiegJlud4UFiZ5sm6Kdn2mBr5t7pJ9rlG0cHg5gXitdaxwFGArIGgoaGwYCZ3QFDwjU1AoIzdCQzdPV1c0bZ9vS3tUJBmjQaGXl1OB0feze1+faiBvk8wjnimn55e/o4OtWjp+4NPIKogsXjaA3g/fiGZBQAcEAFgQGOChgYEEDCCBBLihwQILJkxIe/3wMKfJBSQkJYJpUyRIkgwcVUJq8QLPmTYoyY6ZcyfJmTp08iYZc8MBkhZgxk9aEcPOlzp5FmwI9KdWn1qASurJkClRoWKwhq6IUqpJBAwQEMBYroAHkhLt3+RyzhgCDgAV48Wbgg+waAnoLMgTOm6DwQ8CLBzdGdvjw38V5JTg2lzhyTMeUEwBWHPgzZc4TSOM1bZia6LuqJxCmnOxv7NSsl1mGHHiw5tOuIWeAEHcFATwJME/ApgFBc3MVLEgPvE+Ddb4JokufPmFBAuvPXWu3MIF89wTOmxvOvp179evQtwf2nr6aApPyzVd3jn089e/8xdfeXe/xdZ9/d1ngHf98lbHH3V0LMrgPgsWpcFwBEFBgHmyNXWeYAgLc1UF5sG2wTHjIhNjBiIKZCN81GGyQwYq9uajeMiBOQGOLJ1KjTI40kmfBYNfc2NcGIpI4pI0vyrhjiT1WFqOOLEIZnjVOVpmajYfBiCSNLGbA5YdOkjdihSkQwIEEEWg4nQUmvYhYe+bFKaFodN5lp3rKvJYfnBKAJ+gGDMi3mmbwWYfng7IheuWihu5p32XcSWdSj+stkF95dp64jJ+RBipocHkCCp6PCiRQ6INookCAAwy0yd2CtNET3Yo7RvihBjFZAOaKDHT43DL4BQnsZMo8xx6uI1oQrHXXhHZrB28G62n/YSYxi+uzP2IrgbbHbiaer7hCiOxDFWhrbmGnLVuus5NFexhFuHLX6gkEECorlLpZo0CWJG4pLjIACykmBsp0eSSVeC15TDJeUhlkowlL+SWLNJpW2WEF87urXzNWSZ6JOEb7b8g1brZMjCg3ezBtWKKc4MvyEtwybPeaMAA1ECRoAQYHYLpbeYYCLfQ+mtL5c9CnfQpYpUtHOSejEgT9ogZ/GSqd0f2m+LR5WzOtHqlQX1pYwpC+WbXKqSYtpJ5Mt4a01lGzS3akF60AxkcTaLgAyRBPWCoDgHfJqwRuBuzdw/1ml3iCwTIeLUWJN0v4McMe7uasCTxseNWPSxc5RbvIgD7geZLbGrqCG3jepUmbbze63Y6fvjiOylbwOITPfIHEFsAHL/zwxBdvPBVdFKH88sw37/zz0Ecv/fTUV2/99SeEAAAh+QQJCgAAACwAAAAA3AATAAAF/yAgjmRpnmiqrmzrvnAsz3Rt33iu73zv/8CgcEgECAaEpHLJbDqf0Kh0Sq1ar9isdjoQtAQFh2cw8BQEm3T6yHEYHHD4oKCuD9qGvNsxT6QTgAkcHHmFeX11fm17hXwPG35qgnhxbwMPkXaLhgZ9gWp3bpyegX4DcG+inY+Qn6eclpiZkHh6epetgLSUcBxlD2csXXdvBQrHGgoaGhsGaIkFDwjTCArTzX+QadHU3c1ofpHc3dcGG89/4+TYktvS1NYI7OHu3fEJ5tpqBu/k+HX7+nXDB06SuoHm0KXhR65cQT8P3FRAMIAFgVMPwDCAwLHjggIHJIgceeFBg44eC/+ITCCBZYKSJ1FCWPBgpE2YMmc+qNCypwScMmnaXAkUJYOaFVyKLOqx5tCXJnMelcBzJNSYKIX2ZPkzqsyjPLku9Zr1QciVErYxaICAgEUOBRJIgzChbt0MLOPFwyBggV27eCUcmxZvg9+/dfPGo5bg8N/Ag61ZM4w4seDF1fpWhizZmoa+GSortgcaMWd/fkP/HY0MgWbTipVV++wY8GhvqSG4XUEgoYTKE+Qh0OCvggULiBckWEZ4Ggbjx5HXVc58IPQJ0idQJ66XanTpFraTe348+XLizRNcz658eHMN3rNPT+C+G/nodqk3t6a+fN3j+u0Xn3nVTQPfdRPspkL/b+dEIN8EeMm2GAYbTNABdrbJ1hyFFv5lQYTodSZABhc+loCEyhxTYYkZopdMMiNeiBxyIFajV4wYHpfBBspUl8yKHu6ooV5APsZjQxyyeNeJ3N1IYod38cgdPBUid6GCKfRWgAYU4IccSyHew8B3doGJHmMLkGkZcynKk2Z50Ym0zJzLbDCmfBbI6eIyCdyJmJmoqZmnBAXy9+Z/yOlZDZpwYihnj7IZpuYEevrYJ5mJEuqiof4l+NYDEXQpXQcMnNjZNDx1oGqJ4S2nF3EsqWrhqqVWl6JIslpAK5MaIqDeqjJq56qN1aTaQaPbHTPYr8Be6Gsyyh6Da7OkmmqP/7GyztdrNVQBm5+pgw3X7aoYKhfZosb6hyUKBHCgQKij1rghkOAJuZg1SeYIIY+nIpDvf/sqm4yNG5CY64f87qdAwSXKGqFkhPH1ZHb2EgYtw3bpKGVkPz5pJAav+gukjB1UHE/HLNJobWcSX8jiuicMMBFd2OmKwQFs2tjXpDfnPE1j30V3c7iRHlrzBD2HONzODyZtsQJMI4r0AUNaE3XNHQw95c9GC001MpIxDacFQ+ulTNTZlU3O1eWVHa6vb/pnQUUrgHHSBKIuwG+bCPyEqbAg25gMVV1iOB/IGh5YOKLKIQ6xBAcUHmzjIcIqgajZ+Ro42DcvXl7j0U4WOUd+2IGu7DWjI1pt4DYq8BPm0entuGSQY/4tBi9Ss0HqfwngBQtHbCH88MQXb/zxyFfRRRHMN+/889BHL/301Fdv/fXYZ39CCAAh+QQJCgAAACwAAAAA3AATAAAF/yAgjmRpnmiqrmzrvnAsz3Rt33iu73zv/8CgcEgECAaEpHLJbDqf0Kh0Sq1ar9isdjoQtAQFh2fAKXsKm7R6Q+Y43vABep0mGwwOPH7w2CT+gHZ3d3lyagl+CQNvg4yGh36LcHoGfHR/ZYOElQ9/a4ocmoRygIiRk5p8pYmZjXePaYBujHoOqp5qZHBlHAUFXitddg8PBg8KGsgayxvGkAkFDwgICtPTzX2mftHW3QnOpojG3dbYkNjk1waxsdDS1N7ga9zw1t/aifTk35fu6Qj3numL14fOuHTNECHqU4DDgQEsCCwidiHBAwYQMmpcUOCAhI8gJVzUuLGThAQnP/9abEAyI4MCIVOKZNnyJUqUJxNcGNlywYOQgHZirGkSJ8gHNEky+AkS58qWEJYC/bMzacmbQHkqNdlUJ1KoSz2i9COhmQYCEXtVrCBgwYS3cCf8qTcNQ9u4cFFOq2bPLV65Cf7dxZthbjW+CgbjnWtNgWPFcAsHdoxgWWK/iyV045sAc2S96SDn1exYw17REwpLQEYt2eW/qtPZRQAB7QoC61RW+GsBwYZ/CXb/XRCYLsAKFizEtUAc+G7lcZsjroscOvTmsoUvx15PwccJ0N8yL17N9PG/E7jv9S4hOV7pdIPDdZ+ePDzv2qMXn2b5+wTbKuAWnF3oZbABZY0lVmD/ApQd9thybxno2GGuCVDggaUpoyBsB1bGGgIYbJCBcuFJiOAyGohIInQSmmdeiBnMF2GHfNUlIoc1rncjYRjW6NgGf3VQGILWwNjBfxEZcAFbC7gHXQcfUYOYdwzQNxo5yUhQZXhvRYlMeVSuSOJHKJa5AQMQThBlZWZ6Bp4Fa1qzTAJbijcBlJrtxeaZ4lnnpZwpukWieGQmYx5ATXIplwTL8DdNZ07CtWYybNIJF4Ap4NZHe0920AEDk035kafieQrqXofK5ympn5JHKYjPrfoWcR8WWQGp4Ul32KPVgXdnqxM6OKqspjIYrGPDrlrsZtRIcOuR86nHFwbPvmes/6PH4frrqbvySh+mKGhaAARPzjjdhCramdoGGOhp44i+zogBkSDuWC5KlE4r4pHJkarXrj++Raq5iLmWLlxHBteavjG+6amJrUkJJI4Ro5sBv9AaOK+jAau77sbH7nspCwNIYIACffL7J4JtWQnen421nNzMcB6AqpRa9klonmBSiR4GNi+cJZpvwgX0ejj71W9yR+eIgaVvQgf0l/A8nWjUFhwtZYWC4hVnkZ3p/PJqNQ5NnwUQrQCGBBBMQIGTtL7abK+5JjAv1fi9bS0GLlJHgdjEgYzzARTwC1fgEWdJuKKBZzj331Y23qB3i9v5aY/rSUC4w7PaLeWXmr9NszMFoN79eeiM232o33EJAIzaSGwh++y012777bhT0UURvPfu++/ABy/88MQXb/zxyCd/QggAIfkECQoAAAAsAAAAANwAEwAABf8gII5kaZ5oqq5s675wLM90bd94ru987//AoHBIBAgGhKRyyWw6n9CodEqtWq/YrHY6ELQEBY5nwCk7xIWNer0hO95wziC9Ttg5b4ND/+Y87IBqZAaEe29zGwmJigmDfHoGiImTjXiQhJEPdYyWhXwDmpuVmHwOoHZqjI6kZ3+MqhyemJKAdo6Ge3OKbEd4ZRwFBV4rc4MPrgYPChrMzAgbyZSJBcoI1tfQoYsJydfe2amT3d7W0OGp1OTl0YtqyQrq0Lt11PDk3KGoG+nxBpvTD9QhwCctm0BzbOyMIwdOUwEDEgawIOCB2oMLgB4wgMCx44IHBySIHClBY0ePfyT/JCB5weRJCAwejFw58kGDlzBTqqTZcuPLmCIBiWx58+VHmiRLFj0JVCVLl0xl7qSZwCbOo0lFWv0pdefQrVFDJtr5gMBEYBgxqBWwYILbtxPsqMPAFu7blfa81bUbN4HAvXAzyLWnoDBguHIRFF6m4LBbwQngMYPXuC3fldbyPrMcGLM3w5wRS1iWWUNlvnElKDZtz/EEwaqvYahQoexEfyILi4RrYYKFZwJ3810QWZ2ECrx9Ew+O3K6F5Yq9zXbb+y30a7olJJ+wnLC16W97Py+uwdtx1NcLWzs/3G9e07stVPc9kHJ0BcLtQp+c3ewKAgYkUAFpCaAmmHqKLSYA/18WHEiZPRhsQF1nlLFWmIR8ZbDBYs0YZuCGpGXWmG92aWiPMwhEOOEEHXRwIALlwXjhio+BeE15IzpnInaLbZBBhhti9x2GbnVQo2Y9ZuCfCgBeMCB+DJDIolt4iVhOaNSJdCOBUfIlkmkyMpPAAvKJ59aXzTQzJo0WoJnmQF36Jp6W1qC4gWW9GZladCiyJd+KnsHImgRRVjfnaDEKuiZvbcYWo5htzefbl5LFWNeSKQAo1QXasdhiiwwUl2B21H3aQaghXnPcp1NagCqYslXAqnV+zYWcpNwVp9l5eepJnHqL4SdBi56CGlmw2Zn6aaiZjZqfb8Y2m+Cz1O0n3f+tnvrGbF6kToApCgAWoNWPeh754JA0vmajiAr4iOuOW7abQXVGNriBWoRdOK8FxNqLwX3oluubhv8yluRbegqGb536ykesuoXhyJqPQJIGbLvQhkcwjKs1zBvBwSZIsbcsDCCBAAf4ya+UEhyQoIiEJtfoZ7oxUOafE2BwgMWMqUydfC1LVtiArk0QtGkWEopzlqM9aJrKHfw5c6wKjFkmXDrbhwFockodtMGFLWpXy9JdiXN1ZDNszV4WSLQCGBKoQYHUyonqrHa4ErewAgMmcAAF7f2baIoVzC2p3gUvJtLcvIWqloy6/R04mIpLwDhciI8qLOB5yud44pHPLbA83hFDWPjNbuk9KnySN57Av+TMBvgEAgzzNhJb5K777rz37vvvVHRRxPDEF2/88cgnr/zyzDfv/PPQnxACACH5BAkKAAAALAAAAADcABMAAAX/ICCOZGmeaKqubOu+cCzPdG3feK7vfO//wKBwSAQIBoSkcslsOp/QqHRKrVqv2Kx2OhC0BIUCwcMpO84OT2HDbm8GHLQjnn6wE3g83SA3DB55G3llfHxnfnZ4gglvew6Gf4ySgmYGlpCJknochWiId3kJcZZyDn93i6KPl4eniopwq6SIoZKxhpenbhtHZRxhXisDopwPgHkGDxrLGgjLG8mC0gkFDwjX2AgJ0bXJ2djbgNJsAtbfCNB2oOnn6MmKbeXt226K1fMGi6j359D69ua+QZskjd+3cOvY9XNgp4ABCQNYEDBl7EIeCQkeMIDAseOCBwckiBSZ4ILGjh4B/40kaXIjSggMHmBcifHky5gYE6zM2OAlzGM6Z5rs+fIjTZ0tfcYMSlLCUJ8fL47kCVXmTjwPiKJkUCDnyqc3CxzQmYeAxAEGLGJYiwCDgAUT4sqdgOebArdw507IUNfuW71xdZ7DC5iuhGsKErf9CxhPYgUaEhPWyzfBMgUIJDPW6zhb5M1y+R5GjFkBaLmCM0dOfHqvztXYJnMejaFCBQlmVxAYsEGkYnQV4lqYMNyCtnYSggNekAC58uJxmTufW5w55mwKkg+nLp105uTC53a/nhg88fMTmDfDVl65Xum/IZt/3/zaag3a5W63nll1dvfiWbaaZLmpQIABCVQA2f9lAhTG112PQWYadXE9+FtmEwKWwQYQJrZagxomsOCAGVImInsSbpCBhhwug6KKcXXQQYUcYuDMggrASFmNzjjzzIrh7cUhhhHqONeGpSEW2QYxHsmjhxpgUGAKB16g4IIbMNCkXMlhaJ8GWVJo2I3NyKclYF1GxgyYDEAnXHJrMpNAm/rFBSczPiYAlwXF8ZnmesvoOdyMbx7m4o0S5LWdn4bex2Z4xYmEzaEb5EUcnxbA+WWglqIn6aHPTInCgVbdlZyMqMrIQHMRSiaBBakS1903p04w434n0loBoQFOt1yu2YAnY68RXiNsqh2s2qqxuyKb7Imtmgcrqsp6h8D/fMSpapldx55nwayK/SfqCQd2hcFdAgDp5GMvqhvakF4mZuS710WGIYy30khekRkMu92GNu6bo7r/ttjqwLaua5+HOdrKq5Cl3dcwi+xKiLBwwwom4b0E6xvuYyqOa8IAEghwQAV45VvovpkxBl2mo0W7AKbCZXoAhgMmWnOkEqx2JX5nUufbgJHpXCfMOGu2QAd8eitpW1eaNrNeMGN27mNz0swziYnpSbXN19gYtstzfXrdYjNHtAIYGFVwwAEvR1dfxdjKxVzAP0twAAW/ir2w3nzTd3W4yQWO3t0DfleB4XYnEHCEhffdKgaA29p0eo4fHLng9qoG+OVyXz0gMeWGY7qq3xhiRIEAwayNxBawxy777LTXbjsVXRSh++689+7778AHL/zwxBdv/PEnhAAAIfkECQoAAAAsAAAAANwAEwAABf8gII5kaZ5oqq5s675wLM90bd94ru987//AoHBIBAgGhKRyyWw6n9CodEqtWq/YrHY6ELQEhYLD4BlwHGg0ubBpuzdm9Dk9eCTu+MTZkDb4PXYbeIIcHHxqf4F3gnqGY2kOdQmCjHCGfpCSjHhmh2N+knmEkJmKg3uHfgaaeY2qn6t2i4t7sKAPbwIJD2VhXisDCQZgDrKDBQ8aGgjKyhvDlJMJyAjV1gjCunkP1NfVwpRtk93e2ZVt5NfCk27jD97f0LPP7/Dr4pTp1veLgvrx7AL+Q/BM25uBegoYkDCABYFhEobhkUBRwoMGEDJqXPDgQMUEFC9c1LjxQUUJICX/iMRIEgIDkycrjmzJMSXFlDNJvkwJsmdOjQwKfDz5M+PLoSGLQqgZU6XSoB/voHxawGbFlS2XGktAwKEADB0xiEWAodqGBRPSqp1wx5qCamDRrp2Qoa3bagLkzrULF4GCvHPTglRAmKxZvWsHayBcliDitHUlvGWM97FgCdYWVw4c2e/kw4HZJlCwmDBhwHPrjraGYTHqtaoxVKggoesKAgd2SX5rbUMFCxOAC8cGDwHFwBYWJCgu4XfwtcqZV0grPHj0u2SnqwU+IXph3rK5b1fOu7Bx5+K7L6/2/Xhg8uyXnQ8dvfRiDe7TwyfNuzlybKYpgIFtKhAgwEKkKcOf/wChZbBBgMucRh1so5XH3wbI1WXafRJy9iCErmX4IWHNaIAhZ6uxBxeGHXQA24P3yYfBBhmgSBozESpwongWOBhggn/N1aKG8a1YY2oVAklgCgQUUwGJ8iXAgItrWUARbwpqIOWEal0ZoYJbzmWlZCWSlsAC6VkwZonNbMAAl5cpg+NiZwpnJ0Xylegmlc+tWY1mjnGnZnB4QukMA9UJRxGOf5r4ppqDjjmnfKilh2ejGiyJAgF1XNmYbC2GmhZ5AcJVgajcXecNqM9Rx8B6bingnlotviqdkB3YCg+rtOaapFsUhSrsq6axJ6sEwoZK7I/HWpCsr57FBxJ1w8LqV/81zbkoXK3LfVeNpic0KRQG4NHoIW/XEmZuaiN6tti62/moWbk18uhjqerWS6GFpe2YVotskVssWfBOAHACrZHoWcGQwQhlvmsdXBZ/F9YLMF2jzUuYBP4a7CLCnoEHrgkDSCDAARUILAGaVVqAwQHR8pZXomm9/ONhgjrbgc2lyYxmpIRK9uSNjrXs8gEbTrYyl2ryTJmsLCdKkWzFQl1lWlOXGmifal6p9VnbQfpyY2SZyXKVV7JmZkMrgIFSyrIeUJ2r7YKnXdivUg1kAgdQ8B7IzJjGsd9zKSdwyBL03WpwDGxwuOASEP5vriO2F3nLjQdIrpaRDxqcBdgIHGA74pKrZXiR2ZWuZt49m+o3pKMC3p4Av7SNxBa456777rz37jsVXRQh/PDEF2/88cgnr/zyzDfv/PMnhAAAIfkECQoAAAAsAAAAANwAEwAABf8gII5kaZ5oqq5s675wLM90bd94ru987//AoHBIBAgGhKRyyWw6n9CodEqtWq/YrHY6ELQEhYLDUPAMHGi0weEpbN7wI8cxTzsGj4R+n+DUxwaBeBt7hH1/gYIPhox+Y3Z3iwmGk36BkIN8egOIl3h8hBuOkAaZhQlna4BrpnyWa4mleZOFjrGKcXoFA2ReKwMJBgISDw6abwUPGggazc0bBqG0G8kI1tcIwZp51djW2nC03d7BjG8J49jl4cgP3t/RetLp1+vT6O7v5fKhAvnk0UKFogeP3zmCCIoZkDCABQFhChQYuKBHgkUJkxpA2MhxQYEDFhNcvPBAI8eNCx7/gMQYckPJkxsZPLhIM8FLmDJrYiRp8mTKkCwT8IQJwSPQkENhpgQpEunNkzlpWkwKdSbGihKocowqVSvKWQkIOBSgQOYFDBgQpI0oYMGEt3AzTLKm4BqGtnDjirxW95vbvG/nWlub8G9euRsiqqWLF/AEkRoiprX2wLDeDQgkW9PQGLDgyNc665WguK8C0XAnRY6oGPUEuRLsgk5g+a3cCxUqSBC7gsCBBXcVq6swwULx4hayvctGPK8FCwsSLE9A3Hje6NOrHzeOnW695sffRi/9HfDz7sIVSNB+XXrmugo0rHcM3X388o6jr44ceb51uNjF1xcC8zk3wXiS8aYC/wESaLABBs7ch0ECjr2WAGvLsLZBeHqVFl9kGxooV0T81TVhBo6NiOEyJ4p4IYnNRBQiYCN6x4wCG3ZAY2If8jXjYRcyk2FmG/5nXAY8wqhWAii+1YGOSGLoY4VRfqiAgikwmIeS1gjAgHkWYLQZf9m49V9gDWYWY5nmTYCRM2TS5pxxb8IZGV5nhplmhJyZadxzbrpnZ2d/6rnZgHIid5xIMDaDgJfbLdrgMkKW+Rygz1kEZz1mehabkBpgiQIByVikwGTqVfDkk2/Vxxqiqur4X3fksHccre8xlxerDLiHjQIVUAgXr77yFeyuOvYqXGbMrbrqBMqaFpFFzhL7qv9i1FX7ZLR0LUNdcc4e6Cus263KbV+inkAAHhJg0BeITR6WmHcaxhvXg/AJiKO9R77ILF1FwmVdAu6WBu+ZFua72mkZWMfqBElKu0G8rFZ5n4ATp5jkmvsOq+Nj7u63ZMMPv4bveyYy6fDH+C6brgnACHBABQUrkGirz2FwAHnM4Mmhzq9yijOrOi/MKabH6VwBiYwZdukEQAvILKTWXVq0ZvH5/CfUM7M29Zetthp1eht0eqkFYw8IKXKA6mzXfTeH7fZg9zW0AhgY0TwthUa6Ch9dBeIsbsFrYkRBfgTfiG0FhwMWnbsoq3cABUYOnu/ejU/A6uNeT8u4wMb1WnBCyJJTLjjnr8o3OeJrUcpc5oCiPqAEkz8tXuLkPeDL3Uhs4fvvwAcv/PDEU9FFEcgnr/zyzDfv/PPQRy/99NRXf0IIACH5BAkKAAAALAAAAADcABMAAAX/ICCOZGmeaKqubOu+cCzPdG3feK7vfO//wKBwSAQIBoSkcslsOp/QqHRKrVqv2Kx2OhC0BIWCw/AoDziOtCHt8BQ28PjmzK57Hom8fo42+P8DeAkbeYQcfX9+gYOFg4d1bIGEjQmPbICClI9/YwaLjHAJdJeKmZOViGtpn3qOqZineoeJgG8CeWUbBV4rAwkGAhIVGL97hGACGsrKCAgbBoTRhLvN1c3PepnU1s2/oZO6AtzdBoPf4eMI3tIJyOnF0YwFD+nY8e3z7+Xfefnj9uz8cVsXCh89axgk7BrAggAwBQsYIChwQILFixIeNIDAseOCBwcSXMy2sSPHjxJE/6a0eEGjSY4MQGK86PIlypUJEmYsaTKmyJ8JW/Ls6HMkzaEn8YwMWtPkx4pGd76E4DMPRqFTY860OGhogwYagBFoKEABA46DEGBAoEBB0AUT4sqdIFKBNbcC4M6dkEEk22oYFOTdG9fvWrtsBxM23MytYL17666t9phwXwlum2lIDHmuSA2IGyuOLOHv38qLMbdFjHruZbWgRXeOe1nC2BUEDiyAMMHZuwoTLAQX3nvDOAUW5Vogru434d4JnAsnPmFB9NBshQXfa9104+Rxl8e13rZxN+CEydtVsFkd+vDjE7C/q52wOvb4s7+faz025frbxefWbSoQIAEDEUCwgf9j7bUlwHN9ZVaegxDK1xYzFMJH24L5saXABhlYxiEzHoKoIV8LYqAMaw9aZqFmJUK4YHuNfRjiXhmk+NcyJgaIolvM8BhiBx3IleN8lH1IWAcRgkZgCgYiaBGJojGgHHFTgtagAFYSZhF7/qnTpY+faVlNAnqJN0EHWa6ozAZjBtgmmBokwMB01LW5jAZwbqfmlNips4B4eOqJgDJ2+imXRZpthuigeC6XZTWIxilXmRo8iYKBCwiWmWkJVEAkfB0w8KI1IvlIpKnOkVpqdB5+h96o8d3lFnijrgprjbfGRSt0lH0nAZG5vsprWxYRW6Suq4UWqrLEsspWg8Io6yv/q6EhK0Fw0GLbjKYn5CZYBYht1laPrnEY67kyrhYbuyceiR28Pso7bYwiXjihjWsWuWF5p/H765HmNoiur3RJsGKNG/jq748XMrwmjhwCfO6QD9v7LQsDxPTAMKsFpthyJCdkmgYiw0VdXF/Om9dyv7YMWGXTLYpZg5wNR11C78oW3p8HSGgul4qyrJppgllJHJZHn0Y0yUwDXCXUNquFZNLKyYXBAVZvxtAKYIQEsmPgDacr0tltO1y/DMwYpkgUpJfTasLGzd3cdCN3gN3UWRcY3epIEPevfq+3njBxq/kqBoGBduvea8f393zICS63ivRBTqgFpgaWZEIUULdcK+frIfAAL2AjscXqrLfu+uuwx05FF0XUbvvtuOeu++689+7778AHL/wJIQAAOwAAAAAAAAAAAA==';

        function autologin() {
            $.ajax({
                url: "/login.phtml",
                type: "post",
                data: { login: user, pass: pass, action: "login", ">> Login_x": "33" },
                success: function (response, textStatus, jqXHR) {
                    if (response.indexOf("<title>Comunio.es Iniciar sesión</title>") == -1) {
                        var okMsg = "<div class='success' style='height: 90px!important; text-align: center;'>"
                            + "<div style='height: 60px;'>"
                            + '<img alt="success" src="' + imagesLogin['i_hook'] + '" style="float: left; margin-right: 4px;"/>'
                            + "<div style='font-size:18px; padding-bottom: 10px; padding-top: 5px;'>Acceso satisfactorio (" + contador_errores + " intentos)</div>"
                            + "</div>"
                            + "</div>";
                        if ($("#contentfullsize .barcenter")) {
                            $("#contentfullsize .barcenter").html(okMsg);
                        }
                        if ($("#manager")) {
                            $("#manager").html(okMsg);
                        }
                        var comunio = "";
                        if (window.location.href.indexOf("https://") != -1) {
                            comunio = window.location.href.substring(0, window.location.href.indexOf("/", "https://".length));
                        } else {
                            comunio = window.location.href.substring(0, window.location.href.indexOf("/", "http://".length));
                        }
                        location.href = comunio + "/team_news.phtml";
                    } else {
                        contador_errores++;
                        var errorMsg = "<div class='warning' style='height: 90px!important; text-align: center;'>"
                            + "<div style='height: 60px;'>"
                            + '<img alt="success" src="' + imagesLogin['i_hook'] + '" style="display: none; float: left; margin-right: 4px;"/>'
                            + "<img alt='warning' src='" + imagesLogin['i_error_sign'] + "' style='float: left; margin-right: 4px;'/>"
                            + "<div style='font-size:18px; padding-bottom: 10px; padding-top: 5px;'>Error (Intento " + contador_errores + "):</div>"
                            + "<span>" + $(jqXHR.responseText).find("#contentfullsize").find("div.warning").text() + "</span>"
                            + "</div>"
                            + "<img src='" + imagesLogin['ajaxload'] + "'\>"
                            + "<div><a href='javascript:window.location.reload();' style='font-size: 10px; text-decoration: none;'>Cancelar &gt;&gt;</a></div>"
                            + "</div>";
                        if ($("#contentfullsize .barcenter")) {
                            $("#contentfullsize .barcenter").html(errorMsg);
                        }
                        if ($("#manager")) {
                            $("#manager").html(errorMsg);
                        }
                        setTimeout(autologin, 2500);
                    }
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    alert("ScriptBETA - Error de conexión: " + textStatus, errorThrown
                    );
                },
                complete: function () {
                }
            });
        }

        $("div#manager form,div#contentfullsize form").css("display", "inline");
        $("div#manager form div,div#contentfullsize form div").css("float", "left");
        $("div#manager,div#contentfullsize").find(".login").before("<a href='javascript:;' id='login2' class='login'>&gt;&gt; AutoLogin</a>");
        $("a#login2").click(function () {
            contador_errores = 0;

            var loadMsg = "<div class='note' style='height: 90px!important; text-align: center;'>"
                + "<div style='height: 60px;'>"
                + "<img alt='warning' src='" + imagesLogin['i_error_sign'] + "' style='float: left; margin-right: 4px;'/>"
                + "<div style='font-size:18px; padding-bottom: 10px; padding-top: 5px;'>Intentando conectar</div>"
                + "</div>"
                + "<img src='" + imagesLogin['ajaxload'] + "'\>"
                + "<div><a href='javascript:window.location.reload();' style='font-size: 10px; text-decoration: none;'>Cancelar &gt;&gt;</a></div>"
                + "</div>";
            if ($("#contentfullsize .barcenter")) {
                $("#contentfullsize .barcenter form").hide();
                $("#contentfullsize .barcenter").append(loadMsg);
            }
            if ($("#manager")) {
                $("#manager form").hide();
                $("#manager").append(loadMsg);
            }

            user = $("div#manager,div#contentfullsize").find("input[name='login']").val();
            pass = $("div#manager,div#contentfullsize").find("input[name='pass']").val();
            autologin();
        });
    }

    /**************************************************** Fin página de inicio ****************************************/

    /**************************************************** Página de alineación, clasificación y noticias ********************************************/

    if (window.location.href.indexOf("lineup") != -1 || window.location.href.indexOf("standings.phtml") != -1 || window.location.href.indexOf("www.comunio.es/team_news.phtml") != -1) {

        function getfecha(r) {
            var n = 0;
            partidos = $(r).find(".tablecontent03 tr:gt(0):lt(10)");
            var jornada = $(r).find(".tablecontent03 tr:eq(1) td:eq(0)").html();
            var year = new Date().getFullYear();

            var table = $('<div style="margin-left: 100px;"><div class="titleboxcontent" style="width: 70%;"><div class="titlecontent"><h3><a title="Ver informacion sobre los partidos" href="#" onclick=window.open("' + urlNmk + 'jornada/'+jornada+'/temporada/'+year+'-'+(year+1)+'/liga-BBVA/comunio?utm_campaign=scr1&utm_medium=extension&utm_source=scr","nmk","scrollbars=yes,width=740,height=600")>Partidos de la jornada</a></h3></div></div><div class="tablebox"><table style="width: 70%;"><tbody></tbody></table></div></div>');
            partidos.each(function (index, tr) {
                $(tr).find("td:eq(0)").remove();
                $(tr).find("td:eq(2)").remove();
                $(tr).find("td:gt(3)").remove();

                var equipo = $(tr).find("td:eq(0)").html();

                var enlaceEquipo = '<a title="Ver informacion sobre el equipo en una nueva ventana" href="#" onclick=window.open("' + urlNmk + 'comunio/equipo/' + toClassName(equipo) + '/puntos?utm_campaign=scr1&utm_medium=extension&utm_source=scr","nmk","scrollbars=yes,width=740,height=600")></a>';
                $(tr).find("td:eq(0)").wrapInner(enlaceEquipo);
                var escudoImg = $(tr).find("td:eq(1)").html();
                $(tr).find("td:eq(1)").wrapInner(enlaceEquipo);
                $(tr).find("td:eq(1) a").html(escudoImg);

                equipo = $(tr).find("td:eq(3)").html();

                enlaceEquipo = '<a title="Ver informacion sobre el equipo en una nueva ventana" href="#" onclick=window.open("' + urlNmk + 'comunio/equipo/' + toClassName(equipo) + '/puntos?utm_campaign=scr1&utm_medium=extension&utm_source=scr","nmk","scrollbars=yes,width=740,height=600")></a>';
                $(tr).find("td:eq(3)").wrapInner(enlaceEquipo);
                escudoImg = $(tr).find("td:eq(2)").html();
                $(tr).find("td:eq(2)").wrapInner(enlaceEquipo);
                $(tr).find("td:eq(2) a").html(escudoImg);

                $(table).find("tbody:last").append(tr);
            });
            partidos = table;

            $(r).find("tr").each(function (index) {
                var valida = $(this).find("td").eq(8).text();

                if (validarFecha(valida) == true) {
                    fechahora[n] = $(this).find("td").eq(8).text();
                    var year = parseInt("20" + fechahora[n].substring(6, 8), 10);
                    var month = parseInt(fechahora[n].substring(3, 5), 10) - 1;
                    var day = parseInt(fechahora[n].substring(0, 3), 10);
                    var hour = parseInt(fechahora[n].substring(9, 12), 10);
                    var minute = parseInt(fechahora[n].substring(13, 16), 10);
                    arrayfecha[n] = new Date(year, month, day, hour, minute);
                    n++;
                }
            });

            arrayfecha.sort(function (date1, date2) {
                if (date1 > date2) return 1;
                if (date1 < date2) return -1;
                return 0;
            });

            tfaltan();
        }

        function tfaltan() {
            var noticetiempoDiv = document.getElementById("tiempo");
            var actualiza = 1000;
            if (noticetiempoDiv) {
                var futuro = arrayfecha[0];
                var ahora = new Date();
                var faltan = futuro - ahora;
                if (faltan > 0) {
                    var segundos = Math.round(faltan / 1000);
                    var minutos = Math.floor(segundos / 60);
                    var segundos_s = segundos % 60;
                    var horas = Math.floor(minutos / 60);
                    var minutos_s = minutos % 60;
                    var dias = Math.floor(horas / 24);
                    var horas_s = horas % 24;

                    var diast, horast, minutost, segundost;

                    if (dias == 1) {
                        diast = " Día ";
                    } else {
                        diast = " Días ";
                    }
                    if (horas_s == 1) {
                        horast = " Hora ";
                    } else {
                        horast = " Horas ";
                    }
                    if (minutos_s == 1) {
                        minutost = " Minuto ";
                    } else {
                        minutost = " Minutos ";
                    }
                    if (segundos_s == 1) {
                        segundost = " Segundo ";
                    } else {
                        segundost = " Segundos ";
                    }

                    noticetiempoDiv.innerHTML = replaceAll(noticetiempoDiv.innerHTML, noticetiempoDiv.innerHTML, "<strong>" + dias + "</strong>" + diast + "<strong>" + horas_s + "</strong>" + horast + "</br>" + "<strong>" + minutos_s + "</strong>" + minutost + "<strong>" + segundos_s + "</strong>" + segundost);
                    var twitterTiempo = $("#twitterTiempo");
                    if (!twitterTiempo || twitterTiempo.length === 0) {
                        twitter.setAttribute('data-text', "Faltan " + dias + " días, " + horas_s + " horas y " + minutos_s + " minutos para que comience la jornada en #comunio");
                        $("#tiempo").after(twitter);
                        $.getScript("http://platform.twitter.com/widgets.js");
                    }
                    setTimeout(tfaltan, actualiza);
                }
                else {
                    noticetiempoDiv.innerHTML = replaceAll(noticetiempoDiv.innerHTML, noticetiempoDiv.innerHTML, "La jornada ha empezado");
                    var twitterTiempo = $("#twitterTiempo");
                    if (!twitterTiempo || twitterTiempo.length === 0) {
                        $("#smallcontentright .titleboxcontent .titlecontent h2 span.button02").css("background", "rgb(34, 236, 34)");
                        $("#smallcontentright .titleboxcontent .titlecontent h2 span.button02 a").text("¡Ver puntos en directo!");
                        twitter.setAttribute('data-text', "La jornada en #comunio ha empezado");
                        $("#tiempo").after(twitter);
                        $.getScript("http://platform.twitter.com/widgets.js");
                    }
                    return true;
                }
            }
            else {
                setTimeout(tfaltan, actualiza);
            }

            if (partidos) {
                $("#contentleft .spacer10px").before(partidos);
                partidos = undefined;
            }
        }

        function validarFecha(campo) {
            var RegExPattern = /^\d{1,2}\.\d{1,2}\.\d{1,2}\s\d{1,2}\:\d{1,2}$/;
            if ((campo.match(RegExPattern)) && (campo != '')) {
                return true;
            } else {
                return false;
            }
        }

        var twitter = document.createElement('a');
        twitter.setAttribute('id', 'twitterTiempo');
        twitter.setAttribute('href', 'http://twitter.com/share');
        twitter.setAttribute('class', 'twitter-share-button twitter-tweet');
        twitter.setAttribute('data-url', 'http://comunioscript.blogspot.com.es/2014/10/instrucciones-instalacion-script-superplayer-comunio-chrome-firefox.html');
        twitter.setAttribute('data-count', 'horizontal');
        twitter.setAttribute('data-lang', 'es');
        twitter.setAttribute('data-via', 'comunioscript');
        twitter.style.top = '20px';
        twitter.style.left = '300px';
        twitter.innerHTML = "Tweet";

        var idManager;
        if (window.location.href.indexOf("team_news") != -1) {
            $(document).ajaxSuccess(function () {
                $.each($(".article_content_text a"), function (index) {
                    replaceEnlaces.call(this);
                });
            });
        } else {
            var idManager;
            if (window.location.href.indexOf("standings.phtml") != -1) {
                idManager = $('#manager_community #username a').attr("id");
            }
            else {
                idManager = $('form#set_lineup input[name="placedAsPlayer"]').attr("value");
                var urlTeam = $('div#manager_community div#community_name a').attr("href");
                if (urlTeam) {
                    var idTeam = urlTeam.substring(urlTeam.lastIndexOf('#') + 1, urlTeam.length);
                    $("#smallcontentright .titleboxcontent .titlecontent h2").append('<span class="button02" style="background:rgb(255, 153, 0);"><a href="#" onclick=window.open("' + urlNmk + 'comunio/puntos/' + idTeam + '?m=' + idManager + '&utm_campaign=scr1&utm_medium=extension&utm_source=scr","nmk","scrollbars=yes,width=740,height=600") title="Ver puntos">¡Ver puntos!</a></span>');
                }
            }
        }

        var arrayfecha = new Array();
        var fechahora = new Array();
        var partidos;
        var fechaDiv = $("div#title h1");
        var width = 300;
        if (fechaDiv != null) {
            if (window.location.href.indexOf("standings.phtml") != -1) {
                fechaDiv = $("div#contentleftst");
                width = 200;

                var indexPuntos = 3;
                var indexNombre = 2;
                if (window.location.href.indexOf("?currentweekonly_x=34") != -1) {
                    indexPuntos = 2;
                    indexNombre = 1;
                }

                var puntosManager = {};
                var puntosAnterior;
                fechaDiv.find("table.tablecontent03 tr").each(function (index, tr) {
                    if (index > 0) {
                        $(tr).append("<td>-</td>");

                        var puntos = 0;
                        var columnaPuntos = $(tr).find("td:eq(" + indexPuntos + ")");
                        var puntosString = columnaPuntos.text();

                        if (trim(puntosString) !== "-") {
                            puntos = parseInt(columnaPuntos.text(), 10);
                        }

                        var columnaManager = $(tr).find("td:eq(" + indexNombre + ") a").attr("id");
                        puntosManager[columnaManager] = puntos;

                        if (puntosAnterior !== undefined) {
                            var diff = puntosAnterior - puntos;
                            columnaPuntos.html("(" + diff + ") " + puntos);
                        }
                        puntosAnterior = puntos;
                    }
                    else {
                        $(tr).append("<td>Jugadores</td>");
                    }
                });

                puntosAnterior = undefined;
                fechaDiv.find("table.tablecontent03 tr:gt(0)").each(function (index, tr) {
                    var columnaManager = $(tr).find("td:eq(" + indexNombre + ") a").attr("id");
                    var posColumn = $(tr).find("td:eq(0)");
                    if (columnaManager.indexOf(idManager) == -1) {
                        var diff = puntosManager[idManager] - puntosManager[columnaManager];
                        posColumn.html((diff < 0 ? '<span class="negativo">(' + diff : '<span class="positivo">(+' + diff) + ') </span>' + posColumn.text());
                    }

                    var idManagerComunio = columnaManager.substring(columnaManager.lastIndexOf('r') + 1, columnaManager.length);
                    var urlManagerComunio = "http://www.comunio.es/playerInfo.phtml?pid=" + idManagerComunio;
                    $.get(urlManagerComunio, function (r) {
                        var totalJugadores = $(r).find("table.tablecontent03:last tr").length - 1;
                        $(tr).find("td:last").text(totalJugadores);
                    });
                });
            }
            else if (window.location.href.indexOf("team_news") != -1) {
                width = 150;
            }
            var newDiv = document.createElement("div");
            newDiv.style.cssText = "float:right; width:" + width + "px;";
            newDiv.innerHTML = '<div class="spacer10px"></div>'
                + '<div class="titleboxcontent"><div class="edgetitle"><b class="top"><b class="e1"></b><b class="e2"></b><b class="e3"></b><b class="e4"></b><b class="e5"></b><b class="e6"></b><b class="e7"></b><b class="e8"></b><b class="e9"></b><b class="e10"></b><b class="e11"></b></b></div><div class="titlecontent"><p>Tiempo restante para que dé comienzo la jornada</p></div></div>'
                + '<div class="barcenter" style="min-height: 0;"><div id="tiempo"><div>Cargando...</div></div><div style="margin-top:10px;"><p><p style="color:red;">¡¡Nuevo!!</p>Descarga la aplicación de alertas de Comunio</p><a style="width:122px;height: 42px;" id="badge_android_home" target="_blank" href="https://play.google.com/store/apps/details?id=com.comunioalertas.app"></a></div></div>';

            fechaDiv.before(newDiv);
            $.get('http://www.comunio.es/calendarTip.phtml', getfecha);
        }
    }

    /**************************************************** Fin página de alineación, clasificación y noticias ********************************************/

    var playerID = new Array;

    function dMaxTDWidthF(playerNameCol, tables) {
        var dMaxTDWidth = 0;
        for (var i = 0; i < tables.length; i++) {
            var thisTable = tables[i];
            var tableRows = thisTable.getElementsByTagName('tr');
            for (var j = 0; j < tableRows.length; j++) {
                var thisRow = tableRows[j];
                var td = thisRow.getElementsByTagName('td');
                if (td[playerNameCol].offsetWidth > dMaxTDWidth) {
                    dMaxTDWidth = td[playerNameCol].offsetWidth;
                }
            }
        }
        return dMaxTDWidth;
    }

    function actualizaEstado() {
        $.each($("img[id^='estado']"), function (index) {
            var idDiv = $(this).attr('id');
            var jugadorNombre = toClassName(idDiv.replace('estado', ''));
            var estado = playerID[jugadorNombre] ? JSON.parse(playerID[jugadorNombre]).estado : null;
            var data = "";
            var title = "";
            if (estado) {
                var descripcion = (estado.descripcion ? estado.descripcion : '') + (estado.prevision ? estado.prevision : '');
                if (estado.nombre !== "Activo") {
                    $(this).parent().parent().css("background-color", "#fcded3");
                }

                switch (estado.nombre) {
                    case "Duda":
                        data = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9sDBQETFL6kM3YAAASQSURBVDjLjZVbiFZlFIaf9e3znt8mcyzHuphGIxNLEzHHoAMVJV5kSRRkWpCOdVlhSRcVXiZddNPMSAcwKAqhQMiCTiaJ2kllPE+WYzjHmvmP+//33t/q4p80UqEF7833rfWud70XawmXibGNOKIsV1gBLFK4BgURRoCDRtiV53w3cxv5perlvw/j6xExrMphC2443+1YIl7HYsz02SAOdnKE9LcfyQa+hzQ5boRXMuWja/rQyxKPdRMDPWq8NeHShyW6Yw3O9GvB+FNwQRwQg50cpvpVL8me91Rs+jHwdFsvpYuIx7qJgE81KNx3xUMv4HcuAvH/ReqD8cA4IHK+sjGwn+L7zyNJcTewsq2X8nnisceBAj1qnO7WB5/Fmz0P8MD4aK4kJ/aRjQwifoQ/dyl+5+IL5KJkZ39hYvtmJEu3J8K663pQAyAF7rTK+sKChXhRC/x5DiaGsEOnKH7Wi5lzPy1r3yN66HWyckJ55xsweQ6Kw1Acxr2ynWld92CVNaHyAIADsGkJ29zIm1vonAfWQJYBSvnnL4mfeBe/cxmN/i9AlXDZGvKJEezgftyoAEkJ6mVcH9KzR8QmacemhbxjxjYwW5W7w9hCI4G8BpKiNkFb2nHb51PZuQV7aDu1T54jPb2fYPlaGoP9zdxGCcqjUKkQtboAXcZjjhGhS8H1Yw8kBclBMjSrYMeOU+xZTXpwB9HNt2GCAGyOGBc0B03AJmBrUBnFt1UQDHC7q9BpXMG0tIDWwLFgLCaIufKelag4aH491YPfYOauwJvTRbJ7G96s2UC9Ca1DMoy4DsZJsRmdRpVQxEAUgzSacOwUcsQX8uIotuVG4hWbSQf20tj3FuEN85oT0oC8BPUxCGMwBiA0RhizVtEggjACWwQnBxdwFVwlGegnfuAl8uGTVHc8w7S77gVHwWRNxeUBCHwIIlQBoWiAw5pbcjulOvRBKuBk4Av4gmYpUphB49BO4ltvQSIX3ByoQH2wKSKMsK6PzRQDp4xVDgiM1sfLEETNccIQvBzcOvg5ausU+x4lOfABeW0SnASYAJ0E323W+SFpNUNUM4W9ZmYfdRHerg0OY9U0k6J4ChGELhJEtG7cQbxic9MmXyHwmtYFEQQh+AG1c38hwreH2xk0U6tiK2l6rvTTEfCDf5G3QFwAEdJf95IPHWv+x/HFpGdHSSfKucBrd78KBqCtl3EDT6Vn/miU9vwAnn/BlrhAsHwp2ek3EfcnvLk3NN+DqNnEC0gGh6gcOoERts7o5Tto2g6ATfnceKyr9x99Ny9VwsLqVbgdMyCICBYvvrBbbQ61KmQZqlD5/gC1Xw5j0LewvHzJfXz6SbgioMvC22qcm6Y9+hjhnXdcdB20VCTZvZvq19+gpVLRCC/mSt/Vfdh/cs4rHtoAntAOdABlMQZn1iywFlurkQ8Nk/1+hvTkCRrHjkK1moiw3TFsuaqHwcuepvFu5isctNpsJnELprUVrZSx5Qpic0UoAz8a2AV8OKOX3y93M88rVuW4MTwCLBBoo1ZxtVapAiMO/CbCUQun2nqp8z/ib4NB+u9/9e+3AAAAAElFTkSuQmCC';
                        title = 'Duda. ' + descripcion;
                        break;
                    case "Lesionado":
                        data = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAXCAYAAADgKtSgAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAAkQQAAJEEBw7VCmgAAAAd0SU1FB9sDBQEgIoV1w98AAAO5SURBVEjHtVVLaBtXFD1vJI0kj0gUVIdCNTV4FcjCCVmZZBNnVXXT2tUi2GSZBhLIrt0ru0DslpjgdFPIx4KYeNE60qa4MYUa2kUDsQnBoNA4CbZnbDS23vykmdOFLduyLeKm9MKFN/PuO/fdz7tHoL0oAPoA9MeF6P1U17u1jg5NSin/fvOm4pOzACYBTAMI8S8kl0om564MDXGmXKa3vk42GgzrdbLRoGtZfFou8+uhIWrx+ByA3GFAVQBj+VyO7169om9ZtA2DtmnSNU1uGAZd06Q0DNqGQc+y+LZS4Ve5HAGMAYi1BY4IMTVSKLAhJeXyMgPXDRkEXHv5MpwfH+fc+Djni8WwWqmQQRAGrsva0hIbUnK4UKAixM/tHIyNFAqsS0l3dZUMAjIIQgYB71+4wF91nU91nb9ks5wYGGjuk0FAxzTD+paDrQhac5zP5diQks4O8Lb+2NvLFV3niq5zKZvlvbNn99k4phk2pGymKNfsCCWVTN78bnQUXq2GRDp9YNvsXosDwk4cOybcjQ18PzoKLR6/CUBRAPQNDgyc7MxkkDh6FAC492ALmBCbeoAk02l8lMlgKJ8/CaBPAdB/cXAQDd+HEouhzcUOJUosxsD3cXFwEAD6hSrEX+vV6qnA9+FbFqYuX0boOAgdJ6TnKQKAIiU+405AJUUBOjpagCOZDL589AgiFkNEVXEknX4W7cpmu+OaBq9ex+rCAo4vLOD0/lS3Vj8MgVqt5d8zKbH8/Dk+OXMGcU1DVzbbrWiappFEnQSDIIh8aEpIMAw3cUhomqZFpW1LIcSRmBAQkUjEI9FoFm5XQXc7DfZWnYQDIKqqjAkhhBCQti2jrxcXK75tnwoBfNzTg/nz5/FbtdpyK+vFC3zhedvfPyUSSJ840WLT0dnJ4z09IgTg2zZeLy5WAODOTLlM2zD2PYym3tv1iFZ0nffPnWtraxsGZ8plArijAJgsFouIqirCep34cGFYrzOqqig+fAgAkwqA6QcTE/Pm6io8yxL/AVy4liXMtTU8ePx4HsC0AiCsOc63169dg5pKwduTb+xhAm72+74IvWoV8VQK169eRc1xvgEQNnv5yUSp9MPt4WEoicQ+B4lMhn8A+BPA70Ig1dW17QsA3GoVkUQCt2/dwkSpdBdA6aB5/mTkxg02pKS9a57bKyt8Ozu7rc3JGbgu5fIyG1JypFBgRIipLcJpy0R387kc31Uq72Uif4uJ8jtMpB6mOJ+nksm5K5cuvZdDU8lkWw4V/yf7/wPffMCgKaJC2QAAAABJRU5ErkJggg==';
                        title = 'Está lesionado. ' + descripcion;
                        break;
                    case "Sancionado5Amarillas":
                        data = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAaCAYAAAC3g3x9AAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9sDBBEMENAJPeQAAAF2SURBVEjHrZQ7TsNAFEWPnR8QISFhiTSRoGEDERVFStaQDokGhVWwACrYAF1ENkBDAwpldgENIZCECH9nKDIE/2M7jDSy9eb5zrmeN08D+BpgbNTo2DYGBYamMX4c0j+54FWbDTC2thtD3ThrUj0ABEgXpKOe6h03GscFYYPzwvztaXR1OzvWN2t09N3TJtV9kDYIczGlBdJU0wrF1ZowF9+UdqgbR0a7RbfsuBilalMtql3DdLHxELlep1qhUQZUYkpy2GbShsBCcF26Zd6voDTXp5OOn9BSCzHJkXgKeTxhTpv+eJBwRXKWDaOEBeiIOxRhJtDl/K9/hFZxm/7cKGHOQ5CZ6rAInbfsPAmWs9J5gAy0suDVC9CssBkSigpmrjWR2myjlhPLx8vUvTNcPZFoL91ypPK9XEIxlv1CgqIj1GCLC/kFP5A2/zHGUyb645C7+TejdcU+Z0yue/Q1gMtzDtsturUKe0XE3qdMb3r07595+AF802t8X1+GBwAAAABJRU5ErkJggg==';
                        title = 'Es baja por amarillas. ' + descripcion;
                        break;
                    case "SancionadoDobleAmarilla":
                        data = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9sDBBESEupGYxcAAAIQSURBVDjLpZS/ixNBFIC/2d1EI3ooSCJYKAfaRDlE8EdjczYKdpYWCjaWNnKN2Grh3yBoI9gcdgdX2FgdnGilNoeQ8zwLFeUmuZ0fz2I2m02yu0YdeGwyM3zv2zezT8k6DeK5u7TOdCFS4EA84AAPMnxmc+6X3f7y6eWRy7JMzVDy9sA9OkuPiA+DpFmYwu8s/GjN63f+2Ys3l24+4HUVOKK10CU+CF4XYqcQemotanaio21O1xknCCoAKmzXP8PaT2g2wVsQCz7l7Nr8dem2TuA9eRjDoNf7sGTtkwRMZpJOv/7mD3iq4MoNMAbSNIQxHLqQLpKmi/lcFnu3tri9uno8CQZD4wnb99tw7hr0+0wCiknG/rda7Gm3L2bgMmMDfhA2i1SDypJ4rxLEgNupuAm7wbYKVjXvHMFYJo2HSXZBa4jj2W3TFKwlGFcdngzGwbPY5mBsVoqS6zYshVL1oHLjslJMGCv1D8b54VUYax0+pVnrW394wwQ2lKJ43epsjQHnQGTS2IyeSDDVehpclsTasG/UK7IPJAf68W6idegDVbbWhvXpJmQFbNZ3S0a/H16vzLQEmIONdRuNpKb/aR2sirbO8aeRPF/h8flTHItjFgBVXNzfY66j9XwOzg7mv4fAVWk0RJQSCciZ4iO8iurAA9jEmL+2/A5fVd2Gk8Ay3N8HtwQas0C/wcZDuPMbz+muhLC8QtYAAAAASUVORK5CYII=';
                        title = 'Es baja por doble amarilla. ' + descripcion;
                        break;
                    case "SancionadoRojaDirecta":
                        data = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAaCAYAAAC3g3x9AAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9sDBBEMLP9mQWMAAAFDSURBVEjHrZQ9TsNAEEafcWRQUqSxhIXkIim4BAUNUq4AtTuUSyBqOm6RC0BBQ3qukCo0QAI4SMnau6awAo7xz3rNSivPaFffvm9GHgtgBe4BXAhwMVgWLB5hMoJnKwS363lPe0HgMxiAUhDHEEXptyqOYxAC5nO+ptPXmzA8sa8hsMfjc4bD9LIQ6a6K87nj4PT7XWYz1YnAtX0f1ut6ojxdNu/1cMDrAL+vll3WPQNSwbZ027hQ0JQuijKCm017usaWdR7cIWxLV0hoKlTZlKY2S5vSlq7WsknXW1nO5lL+TJ5iy7p0UkKS7IwyM8tx/EeoWFBHSKnKYatnOVenesGqX0+pUnvNLBcUXF8wO22krK2TPmELoazgEiH4j7WAD+7haAUvSVox472E9xGcWQBXcHwKl/twaEL2Bp+3MLmDh28pE7Ug90P0zQAAAABJRU5ErkJggg==';
                        title = 'Es baja por roja directa. ' + descripcion;
                        break;
                    case "NoConvocado":
                        data = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAAEAAAABAABGSOaawAAAAd0SU1FB9sIHQkNMyOBphsAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAE7ElEQVQ4y2WTW2xc5RHHf/Odc9Z7za7jyya7JiZuTGwaClVtioREq7wg7EIKrYQgaQKq2uahF1Thl1Rp01Zq1TYRaqEvVSNxCaqACIgiKqUPLUlTFEOimFwlQmw3bnDihPXm7O3s7jnf9GEtXpjHmdHvP6P/jFQcB2AQGEP1g4y1Vx78+te6i+sG7lm3fv2Tk9987EuOMcPGmLQRFhzXfd+Ldb2E1ek7NmxYBqg4TjcQU9Wb4huzFjgjIr0Cpee+OPLXpQceeHhk5M7Ru8fuJZvL4biGaq2KX1oGETLZVRTXFi42U6k/rr77nllnfv4FEekH9olvzL0iMg0oqtRSSZk78Crx4Y3qOR6O60giHuNnU89y9J//AkGN6zAwOCiv7NoV9n5ne9ssLycQQSE0ApfF2nlURUUkVaky8oOduI1AnFhMPMejXgso+3VyfQViyZTUajUxM6dxJyZdp1RKqIiiiqhecja/dSj4tBls7J2dHXOiCDUGp+KTfH8aO/5VYsUBbpXLnL1wiWzPGvrSWXYuzLOrVqNXhMgYxFpB9aY6zmNm5r8f985MTjw6/bs/4FoLqqjjEDvzIasfeQhn4Qq5nl5GR0dw4wm+/9E5tpZLZFUJRTr9qRRXX345efns2UUjVr5BRP7I0pL+Zt1ttFUxqqgI0miQvm+M7MxpfvStLfzq3Ak2X7qINQYAiSK0v58bhw9rY3ws2fL9p92KX3m6tFzhb/v/IvVGnY+TCZ4LmqSsRY1BbIT3xLcJczkKCwu0OmcG1tLato36Mz/BrsmLV/XZ/8pLO91qvT4+c+okQdDAGMM7IpzPpDnlxQhu3uxAazWkVsOuwCSKCHbsoL5vHzaoo2GLmOdx4cL5AXNj6Xp8fm5OO7KKAWZtxNwbB2kNDnbSIiCCqILr4u/ZQ3nvXtoVn1arSdhuEbbbFAtFcTVq05VIYFAsBlBAaZbKSBTxuVCllUoR1Gs4YRtVC2oJ2yHNZhNjo+hKoVAQMS6oYkVYJ8Lo9q14V69+BmHFKMKQvqkp4ocO0RYhikJarTZhGHL92qKaMAj+3deXJ9vdrclsjvvTaf5eCwjq9Y7T1hJmMgSDt+OqggjWGPLPTuEdP07QbNEMmlQrVb4wtH7JuWvTneWK7+8obhzlcceTPbOzZNtt7AosSqX5z+5fcOyuTXjHjlJUJVqppd49Snl8jGZmlVarFVlbKDwvj26ZWO03micmb3w6/MPTMzSN6Uy2sv6bu3/JZdfl+b2/Ja2W96oNetR+JmgzaU6+8TrlWq0twpB58+13Sj89f/G97314hsBxUBEcawnicV7fup1P0mnCoE6iK0ZNhG3JONeNQVQ7b+pXGP7xM7YSBC80E8lFqRjzlMB+BaMieFHEXH8/rz00QbU4QDKeoN1q8dqBFymXl7EifFnhyC2f5srHgDb8QmFiYOF/7xqF76qIQUSNKudWZfTXmzdzLZNRjSINbUhXIkZPby/pVIbcqiwf5br1zyMjdFmLqCJImP1k8RaAVBxnSuH30pH6xxP5vuOXs7mn+vP5oZFNm8jluknEE6TTSdRajDF4nkfMmMXJ3T8/liuVehA5nImiPwGI7zgx4D4BI6rTaWsbdwxv6Onp6xu/fWjo8TX5/JjnxYqe53UZY66J4WQ81nUAMSfuP3Wq/JWDB720ah3Adxz+D4mOTnz6a+8vAAAAAElFTkSuQmCC';
                        title = 'No ha sido convocado en la última jornada.';
                        break;
                    default:
                        data = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAASCAYAAABfJS4tAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9sDBBELKcBNIysAAAO8SURBVDjLtdRbaBxlGMbxZ2Z2Z2YPkz0le0gyTROT3cQQmxRTUlNIqbW0tCJRqFKEFkWF2oMFjYgGFC+EWsUq6LVIxRLohUgkmqBNrLapzTnmUEy72aS7SXOY3Z3dnZ2d+T4vRKHQFmnwvX75XT38gf/puA0LJeDxEg6jBZsRw59Ig2wY5tvhrzgod3YceP3tymDl/hvuOaJl88NIoPDAMLcdJZGn5feP7zz5yvN1RxzNZc32tJB6bNwYNUwrGb8Dll6A4NgHQRtA4X6o/1W+pu5J+fTRHacO7Sx7QsgZWRBK0Ojfwi+w0Zab6lzB8s+z+AwkT639RYubyOSw9nHySyzeDfUeRaRxd83n7fWHdtW7GrCixUEpAMrg2tIgJhMjdiRpg4WxAdLLEIoD3o7Ht7Udd4p2W5+1u3ytMvVG/Iw5b6p/g9YAmIo3+a1VtfKH7TUH22RbBVbycVACUEoxdPsKLkx2ITa1nNPjmOKkIwh5axzv7W3dc6rZ32IP2kOcz++qV8XEVkTU37OTWOFD4Krewo7GLQ9/vfuhA00ui5fJmEnkTBWqoeDX2z+ie7YLtyaSqewoztBhnOU8e9Fhr+aOhV0RwcaLyNMMJKsEt8spZ1yJBlbWRkra0FT3aOUn20t3hQVWhEZU5GkOWTONa8pFjMX7ER/XUuo4zpq/4SMkkWQ2ncA37lY8W+A5lEmlqHaH4RE9EK0Cssw6ppXhVZco8eGiJomlFhBKoBMdKV3BvDqLlaUEooPG/HI/7dQu4Tw1kAcAS2YRVx0L2OeNmEWrZgyZ9BJchgS3KMEpOFHidvvsnBMKWUCe5JAhKazr69ANDUzKiuURxJJD9J1cP86DQv93jkTDhJHDkt3LbAv4BQcVCQpcBnkuCY1VwLEEVpYBy5oAa4IwBVhZBvyqk85cUsZu9enHctfxnancOVHOVKBnZzDKuqAIDrapPOgqgo2CswAlgh9BoRxBvhzFfBBuqw8+axBaHGTkl+hIrC93cv0n/GwqMO/VCsIwmMitkuuCh2mu9Ic8DoeN8fIBhEQZpeJmBPgy+LgQFheWzd7eK303e9TXtBgGC2ug941QfhlmegbTBi1Mc5LxSCQY9gddMuO1FkMWq1DGh3F55nL+2x96vp/6KnVi/Som74XeNUIki2g2rY8ZDrW+OlRVKhdVM8WWTRiMDhjnLnSdu9Gb7kz9gTlSeMDIBFpRu+cLZ/enU8/lPxh6Ktnyru0zAI4N91hLYK1g6kPx7Kxvcni2Jzqgn1ajUP4r/BdTV5n5/MpgngAAAABJRU5ErkJggg==';
                        title = 'No aparece en la zona de lesionados y sancionados.';
                        break;
                }
            }
            else {
                if (Object.keys(playerID).length === 0) {
                    data = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAZCAMAAADzN3VRAAACxFBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADMyaeDAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAJcEhZcwAARt4AAEbeAY4mMlsAAAAHdElNRQfeBx8JJgpyYB2TAAAAbElEQVQoz2NgIAJMf/369SQs4q9hAJc4uhwSH1UKVR0SD0MCyQA0Ha9fH8DUAubARLDYCCEnIsmgKsbmFAgDxSsMWGUwNHfBzUa2D7t1SDKvsXkKqgJHyKEHPb4gJSJ+8MQpA8MeXBJYrMMNAJqUq77oPSQgAAAAAElFTkSuQmCC';
                    title = 'No se ha podido recuperar la información.';
                }
                else {
                    data = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAdCAYAAABBsffGAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9oBCxQHBigdAwYAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAA50lEQVRIx9XWsQ3CMBBA0R/rdqDIHinYgD1SsAdLUCDWYAf2SMEOkUzBgSAE5852CtJFkd6XbF9k+McnQhsi9GvAwD4AXc3AEwbaAEitwDsMDAE41QhMYeAowFW/9xqgeQSL4AYGaWCMBYFfMLoc5AZS8AvPCSzBH7gnYIG/cEvACs/iqQBwscLqJDdMgE4DI3Czwov4TAArDBAMR3kD7BLvefjM5rl+FeIZEF1z86CJd0A8gybeyfNMsuRMnjUgXtgTkBzYGpBc2BKQEngpIKVwKkCEgy5NrauFRNhGOFMTngbWvM7JHTvnr26ab9ZuAAAAAElFTkSuQmCC';
                    title = 'Ha abandonado la liga.';
                }
            }

            $(this).attr('src', data);
            $(this).attr('title', title);
        });
    }

    function actualizaPuntos() {
        $.each($("div[id^='puntos']"), function (index) {
            var rachaText = "";
            var idDiv = $(this).attr('id');
            var jugadorNombre = toClassName(idDiv.replace('puntos', ''));

            if (Object.keys(playerID).length === 0) {
                rachaText = "No disponible";
            }
            else {
                var racha = playerID[jugadorNombre] ? JSON.parse(playerID[jugadorNombre]).racha : [];
                if (!racha || racha.length == 0) {
                    racha = ['-', '-', '-', '-', '-'];
                }

                racha.forEach(function (item) {
                    if (!item || item === null) {
                        item = '-';
                    }
                    rachaText += "<span class=\"racha" + item + "\">" + item + "</span>"
                });
            }
            $(this).html(rachaText);
        });
    }

    function collectTables() {
        var playerNameCol = 0;
        if (window.location.href.indexOf("playerInfo") != -1) {
            playerNameCol = 2;
        }
        else if (window.location.href.indexOf("exchangemarket")) {
            if (window.location.href.indexOf("acceptoffer_x=34") != -1
                ||
                (window.location.href.indexOf("_x=22") != -1 && window.location.href.indexOf("changeoffer_x") == -1 && window.location.href.indexOf("viewoffers_x") == -1)
                ) {
                playerNameCol = 1;
            }
        }

        var tables1 = document.getElementsByClassName("tablecontent03");
        var tables2 = document.getElementsByClassName("tablecontent03b");
        var tables = [];

        for (var i = 0; i < tables1.length; i++) {
            tables.push(tables1[i]);
        }
        for (var i = 0; i < tables2.length; i++) {
            tables.push(tables2[i]);
        }
        var dMaxTDWidth = dMaxTDWidthF(playerNameCol, tables);
        for (var i = 0; i < tables.length; i++) {
            var thisTable = tables[i];

            var tableRows = thisTable.getElementsByTagName('tr');
            for (var j = 0; j < tableRows.length; j++) {

                var thisRow = tableRows[j];
                var td = thisRow.getElementsByTagName('td');

                if (thisRow.getAttribute('class') == 'tr1' || thisRow.getAttribute('class') == 'tr2' || thisRow.getAttribute('class') == 'ng-scope tr1' || thisRow.getAttribute('class') == 'ng-scope tr2') {
                    if (window.location.href.indexOf("placeOffers.phtml") != -1 || window.location.href.indexOf("exchangemarket.phtml") != -1) {
                        var valorInicial = parseInt($(td[2]).text().replace(/\./g, "").replace(/,/g, ""), 10);
                        var valorMercado = parseInt($(td[3]).text().replace(/\./g, "").replace(/,/g, ""), 10);
                        // TODO: reemplazar posición por div de posicion $(td[7]).text("DEF");
                        if (valorInicial < valorMercado) {
                            var linkUsername = $("#username p a").attr("href");
                            var linkPropietario = $(td[6]).find("a").attr("href");

                            td[2].width = "95px";
                            if (linkUsername === linkPropietario) {
                                $(td[2]).prepend('<span class="racha-1">€</span>')
                            }
                            else {
                                $(td[2]).prepend('<span class="racha6">€</span>');
                            }
                        }
                    }

                    var playerName = toClassName(td[playerNameCol].textContent.replace(/\*/g, ""));
                    var idPlayer = playerID[playerName] ? JSON.parse(playerID[playerName]).id : null;

                    if (idPlayer && idPlayer.length > 0 && idPlayer > 0) {
                        td[playerNameCol].innerHTML = '<br/><a title="Ver informacion sobre jugador en Ventana Nueva" href=# onclick=window.open("' + urlNmk + playerName + '/comunio/puntos/' + idPlayer + '?utm_campaign=scr1&utm_medium=extension&utm_source=scr","nmk","scrollbars=yes,width=740,height=600")>' + td[playerNameCol].textContent + '</a>';
                    }

                    var tdNew = document.createElement("TD");
                    tdNew.appendChild(document.createTextNode(''));
                    tdNew.align = "center";
                    //tdNew.width = "24px";
                    tdNew.innerHTML = '<img width="20px" height="20px" title="Cargando estado..."  src="data:image/png;base64,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" id="estado' + playerName + '" />';
                    thisRow.appendChild(tdNew);

                    var tdNew = document.createElement("TD");
                    tdNew.appendChild(document.createTextNode(''));
                    tdNew.align = "center";
                    tdNew.width = "105px";
                    tdNew.innerHTML = '<div id="puntos' + playerName + '" >S.C.</div>';
                    thisRow.appendChild(tdNew);

                    var tdNew = document.createElement("TD");
                    tdNew.appendChild(document.createTextNode(''));
                    tdNew.align = "center";
                    //tdNew.width = "20px";
                    if (idPlayer && idPlayer.length > 0 && idPlayer > 0) {
                        tdNew.innerHTML = '<img title="Ver informacion sobre el jugador en una nueva ventana" onclick=window.open("' + urlNmk + playerName + '/comunio/puntos/' + idPlayer + '?utm_campaign=scr1&utm_medium=extension&utm_source=scr","nmk","scrollbars=yes,width=740,height=600") src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAABGdBTUEAANjr9RwUqgAAACBjSFJNAABuJwAAc68AAPY3AACApQAAcCMAAN0CAAAwPgAAFrLOXXcKAAAC0UlEQVR42mJkQAfTGRIYGBnigSwHNJkDDP8ZFjJkMixAFgQIIASazKDAMJXhvMMGh//r763/jw5AYiA5kBqwWigACCBGMDkRKMDIcL7ftl8g2SCW4ez/zQx7Xm5nuPP6McPvv/8YRLgEGawEnRm8BWIYttzZwZC4J/ED0DWGDPkMDwACCGJMH8P5+Vfm/3/z/9H/ef/y/3d/j/ufdMX1/5c/n8DY5aje/8Rbjv+Trrr9v/v15v/+s/3/QXpAWgECiImhmyHBQcrBIFjbl2HT/16GD78/Mnz/8YPh9+//DAwgBMS/f/9h+PbzJ8ObH+8YSq4lMURohTKA9ID0AgQQI0MHw/71QesdBFQ+MJz/fRCs+fGrtwyPX79lYGXgZHj/4z0DIxMjAx8vJ8P3n78Yvv36xeAi4stgwGbFELgu8ABAADEytAItqfrPMO1nFsOHn+8ZfgJtO3vjHsMK8wMMPCy8DEAvMDjsMmQQEuQBa/726ycDy38OhlNu1xgY2xgZAAKIheEvJBhgmr8CnQqiYYCHhY/h168/cM0g+sfPzxBJoF6AAGJigKqFaf4KVMTFycbgtssEbshPsAEwzRAaDIB6AQKICeaCf79ZwJp//v7NwMnNxvALyRW/fv1G0czOwAV3AUAAgQw4sOHaBgYVZmOwZlBofwcqAjkb7oLff+GaQXJuUl4MID0gvQABBDJg4cTDE8GJhPE3K1gBKLR/IhnwG+qC71Dbaw1rGUB6QHoBAgiUDhYcuHXgwpLjKxiqFSYzMP9jByv+BXTNp18fGT7+/Aj2DkzzHu+9DBvOb2AA6QHpBQggJkgAMAQWri38sOnUNoZpOivB8czDw8ugPEeWQW6mJAMnJzdDmEIUw5nAswwHLh9gAKkF6QFpBQggBMoB5odsYGaaAMxMF7FkJqAYSA6kBqwWCgACiBEjV2YCs/N/HNmZEZidp6NmZ4AAAwCKRpw0E24bRwAAAABJRU5ErkJggg==" "/></a>';
                    }
                    thisRow.appendChild(tdNew);
                }
            }
        }
    }

    function readPlayersID() {
        var playerString = JSON.parse(localStorage.getItem("playerID"));

        if (playerString) {
            $.each(playerString, function (key, val) {
                playerID[toClassName(val.nombre)] = JSON.stringify(val);
            });
        }
    }

    function showExtraInfoWhenLoadData() {
        var scope = angular.element('[ng-controller=restcallcontroller]').scope();
        if (scope && scope.feed && scope.feed.length > 0) {
            console.log("Feed completo");
            showExtraInfo();
        }
        else {
            console.log("Feed vacío");
            setTimeout(showExtraInfoWhenLoadData, 500);
        }
    }

    function showExtraInfo() {
        collectTables();
        actualizaEstado();
        actualizaPuntos();
        $('table#searchTextResults tr:eq(0)').hide();
    }

    function loadExtraInfo() {
        readPlayersID();
        if (window.location.href.indexOf("exchangemarket") != -1) {
            try {
                var scope = angular.element('[ng-controller=restcallcontroller]').scope();
                if (scope) {
                    showExtraInfoWhenLoadData();
                    console.log("Controlador angular carga REST encontrado");
                }
            }
            catch (err) {
                console.log("Error:", err);
                showExtraInfoWhenLoadData();
            }
        }
        else {
            showExtraInfo();
        }
    }

    function updatePlayersID() {
        var players = {};
        var cacheTime = localStorage.getItem("cacheTime");

        var today = new Date();
        var difference = Number.MAX_VALUE;
        if (cacheTime) {
            difference = today - new Date(cacheTime);
        }

        if (difference > 1800 * 1000) {
            var url = urlNmk + 'comunio/players/jsonp?callback=?';
            $.getJSON(url, function (jsonp) {
                localStorage.setItem("playerID", JSON.stringify(jsonp));
                localStorage.setItem("cacheTime", today);
            })
                .success(function () {
                    console.log("Jugadores cargados correctamente");
                })
                .error(function () {
                    console.log("No se ha podido cargar los jugadores");
                })
                .complete(function () {
                    loadExtraInfo();
                });
        }
        else {
            console.log("Jugadores cargados desde caché");
            loadExtraInfo();
        }
    }

    if (window.location.href.indexOf("exchangemarket") != -1
        || window.location.href.indexOf("placeOffers") != -1
        || window.location.href.indexOf("lineup") != -1
        || window.location.href.indexOf("playerInfo") != -1
        || window.location.href.indexOf("putOnExchangemarket") != -1) {

        if (window.location.href.indexOf("exchangemarket") != -1 || window.location.href.indexOf("placeOffers") != -1) {
            var i = 0;
            $.each($("table[id='searchTextResults'] tr"), function (index) {
                if (i === 0)
                    $(this).css("display", "none");

                i++;
            });
        }
        updatePlayersID();
    }
}

function init() {
    if (window.location.href.indexOf("comuniero.com/") != -1) {
        var publiScriptElements = document.getElementsByClassName('publi_script');
        Array.prototype.forEach.call(publiScriptElements, function (publiScriptElement) {
            if (publiScriptElement.nodeName === 'DIV') {
                publiScriptElement.parentNode.removeChild(publiScriptElement);
            }
        });
    }
    else {

        addJQuery(onLoadJquery);

        var get = function (url, func) {
            var xhr = new XMLHttpRequest();
            xhr.open("GET", url, true);
            xhr.send();
            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4) {
                    func(xhr.responseText);
                }
            }
        };

        function trim(str) {
            return str.replace(/^\s\s*/, '').replace(/\s\s*$/, '');
        }

        function replaceAll(text, busca, reemplaza) {
            if (text != null && text.length > 0) {
                while (text.toString().indexOf(busca) != -1) {
                    text = text.toString().replace(busca, reemplaza);
                }
            }
            return text;
        }

        function addPuntosMiles(num) {
            var rgx = /(\d+)(\d{3})/;
            while (rgx.test(num)) {
                num = num.replace(rgx, '$1' + '.' + '$2');
            }
            return num;
        }

        var precioVentaCol = 3;

        if ((window.location.href.indexOf("exchangemarket.phtml") != -1
            && window.location.href.indexOf("?") == -1)) {
            var allTablesMercado = document.getElementsByTagName('table');
            var saldoControl = document.createElement('div');

            saldoControl.innerHTML = '<table style="margin-top:20px; margin-bottom:20px; width:240px; float:right; height:24px;" border="4" cellpadding="4" cellspacing="0" class="tablecontent06"><theader><tr><td valign="MIDDLE" align="CENTER">Fondos del equipo</td></tr></theader><tbody><tr class="tr1"><td class="text" style="white-space:nowrap;font-size:10px;" align="right"><strong>Actual:</strong> <input size="21px" type="text" name="saldoActual" id="saldoActual" readonly="true" style="background-color:transparent;border:0px;color:#002000;font-size:12px;text-align:right;"/></td></tr><tr class="tr2" id="abiertoTR" class="tr1" ><td class="text" style="white-space:nowrap;font-size:10px"  align="right"/><strong>Ofertas abiertas:</strong><input size="21px" type="text" name="abierto" id="abierto" readonly="true" style="background-color:transparent;border:0px;color:#002000;font-size:12px;text-align:right;" value="0"/><input type="hidden" id="abiertoNames" /></td></tr><tr class="tr1"><td class="text" style="white-space:nowrap;font-size:10px"  align="right"><strong>Ofrecido:</strong><input size="21px" type="text" name="ofrecido" id="ofrecido" readonly="true" style="background-color:transparent;border:0px;color:#002000;font-size:12px;text-align:right;" /></td></tr><tr class="tr2"><td class="text" style="white-space:nowrap;font-size:10px"  align="right"><strong>Vendido:</strong><input size="21px" type="text" name="vendido" id="vendido" readonly="true" style="background-color:transparent;border:0px;color:#002000;font-size:12px;text-align:right;" value="0 €"/><input type="hidden" id="vendidoNames" /></td></tr><tr class="tr1"><td class="text" style="white-space:nowrap;font-size:10px" align="right"><strong>Total (aceptando ventas):</strong> <input size="21px" type="text" name="saldoTotalAbierto" id="saldoTotalAbierto" readonly="true" style="background-color:transparent;border:0px;color:#002000;font-size:12px;text-align:right;" /></td></tr>'
                + '<tr class="tr1"><td class="text" style="white-space:nowrap;font-size:10px" align="right"><strong>Total:</strong> <input size="21px" type="text" name="saldoTotal" id="saldoTotal" readonly="true" style="background-color:transparent;border:0px;color:#002000;font-size:12px;text-align:right;" /></td></tr>'
                + '<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?"http":"https";if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document, "script", "twitter-wjs");</script></td></tr>'
                + '</table>';
            allTablesMercado[allTablesMercado.length - 1].parentNode.insertBefore(saldoControl, allTablesMercado[allTablesMercado.length - 1].nextSibling);

            function recalcularSaldo() {
                document.getElementById('saldoTotalAbierto').value = '';
                document.getElementById('saldoTotal').value = '';
                document.getElementById('ofrecido').value = '';
                document.getElementById('saldoActual').value = '';
                var vendido = parseInt(replaceAll(document.getElementById('vendido').value, ".", "").replace(' €', ''), 10);
                document.getElementById('vendido').value = '';
                var abierto = parseInt(replaceAll(document.getElementById('abierto').value, ".", "").replace(' €', ''), 10);
                document.getElementById('abierto').value = '';
                var ofrecido = 0;
                var inp = document.getElementsByTagName('input');
                for (var i = 0; i < inp.length; i++) {
                    if (inp[i].type == 'text') {
                        if (inp[i].value != '') {
                            inp[i].value = inp[i].value.replace(/\./g, "");
                            if (!isNaN(inp[i].value) == false) {
                                ofrecido = parseInt(ofrecido, 10) + parseInt(inp[i].value.replace(/,/g, ""), 10);
                                inp[i].value = addPuntosMiles(inp[i].value);
                            } else {
                                inp[i].value = '';
                            }

                        }
                    }
                }
                var finanzas = document.getElementById("userbudget");
                var saldo = finanzas.textContent;
                saldo = saldo.substring(saldo.indexOf(':') + 1, saldo.indexOf('€'));
                saldo = saldo.replace(/\./g, "");
                var totalAbierto = parseInt(saldo) - parseInt(ofrecido) + parseInt(abierto) + parseInt(vendido);
                var total = parseInt(saldo) - parseInt(ofrecido) + parseInt(vendido);
                document.getElementById('saldoTotalAbierto').value = addPuntosMiles(totalAbierto + '');
                document.getElementById('saldoTotal').value = addPuntosMiles(total + '');
                document.getElementById('ofrecido').value = addPuntosMiles(ofrecido + '');
                document.getElementById('vendido').value = addPuntosMiles(vendido + '');
                document.getElementById('abierto').value = addPuntosMiles(abierto + '');
                document.getElementById('saldoActual').value = addPuntosMiles(saldo + '');
                if (totalAbierto < 0) {
                    document.getElementById('saldoTotalAbierto').style.color = "red";
                } else {
                    document.getElementById('saldoTotalAbierto').style.color = "#0B3B0B";
                }
                if (total < 0) {
                    document.getElementById('saldoTotal').style.color = "red";
                } else {
                    document.getElementById('saldoTotal').style.color = "#0B3B0B";
                }
            }

            function cambiarOnblurInputs() {
                var inp = document.getElementsByTagName('input');
                for (var i = 0; i < inp.length; i++) {
                    if (inp[i].type == 'text') {
                        inp[i].addEventListener("blur", recalcularSaldo, false);
                    }
                }
            }

            recalcularSaldo();
            cambiarOnblurInputs();

            function getJugadoresVendidos(text) {
                var pujaspos = text.indexOf("Ofertas para ti:");
                var table2pos = text.indexOf("<table", pujaspos);
                var tablaPujasHTML = text.substring(table2pos, text.indexOf("</table", table2pos));
                var divPujas = document.createElement("div");
                divPujas.id = "divVentas";
                divPujas.style.display = "none";
                divPujas.innerHTML = tablaPujasHTML;
                var trsPujas = divPujas.getElementsByTagName("tr");
                for (var i = 0; i < trsPujas.length; i++) {
                    var tdsPujas = trsPujas[i].getElementsByTagName("td");
                    if (tdsPujas[tdsPujas.length - 1].innerHTML == "Aceptada") {

                        var playerNameColNoScript = 0;
                        var nombreJugadorVendido = trim(tdsPujas[playerNameColNoScript].textContent).replace(/"/g, "quot").replace(/\ /g, "_");

                        if (document.getElementById("vendido") != null
                            && document.getElementById("vendidoNames") != null
                            && document.getElementById("vendidoNames").value.indexOf("//" + nombreJugadorVendido + "//") == -1) {
                            var vendidoTotal = parseInt(replaceAll(document.getElementById('vendido').value, ".", "").replace(' €', ''), 10);
                            var vendidoTD = parseInt(replaceAll(tdsPujas[precioVentaCol].innerHTML, ".", ""), 10);
                            document.getElementById('vendido').value = vendidoTotal + vendidoTD;
                            document.getElementById("vendidoNames").value += "//" + nombreJugadorVendido + "//";
                        }
                    }
                }

                if (text.indexOf('title="Siguiente"', pujaspos) != -1) {
                    var botonSiguientePujasPos = text.indexOf('title="Siguiente"', pujaspos);
                    while (text.charAt(--botonSiguientePujasPos) != "<");

                    var hrefSiguientePujaPos = text.indexOf('href=', botonSiguientePujasPos) + 'href="'.length;
                    var hrefSiguientePujaPosFin = text.indexOf('"', hrefSiguientePujaPos);
                    var hrefSiguientePuja = text.substring(hrefSiguientePujaPos, hrefSiguientePujaPosFin);
                    hrefSiguientePuja = replaceAll(hrefSiguientePuja, "&amp;", "&");
                    var comunio = "";
                    if (window.location.href.indexOf("https://") != -1) {
                        comunio = window.location.href.substring(0, window.location.href.indexOf("/", "https://".length));
                    } else {
                        comunio = window.location.href.substring(0, window.location.href.indexOf("/", "http://".length));
                    }
                    get(comunio + "/" + hrefSiguientePuja, getJugadoresVendidos);
                } else {

                    recalcularSaldo();
                    cambiarOnblurInputs();
                }
            }

            if (window.location.href.indexOf("exchangemarket.phtml") != -1) {
                get(window.location.href.replace("exchangemarket.phtml", "") + 'exchangemarket.phtml?viewoffers_x=22', getJugadoresAbiertos);
            } else if (window.location.href.indexOf("placeOffers.phtml") != -1) {
                get(window.location.href.replace("placeOffers.phtml", "") + 'exchangemarket.phtml?viewoffers_x=22', getJugadoresAbiertos);
            }

            function getJugadoresAbiertos(text) {

                var pujaspos = text.indexOf("Ofertas para ti:");
                var table2pos = text.indexOf("<table", pujaspos);
                var tablaPujasHTML = text.substring(table2pos, text.indexOf("</table", table2pos));
                var divPujas = document.createElement("div");
                divPujas.id = "divAbiertos";
                divPujas.style.display = "none";
                divPujas.innerHTML = tablaPujasHTML;
                var trsPujas = divPujas.getElementsByTagName("tr");
                if (text.indexOf('Desafortunadamente no hay ninguna oferta para ti') == -1) {
                    for (var i = 0; i < trsPujas.length; i++) {
                        var tdsPujas = trsPujas[i].getElementsByTagName("td");
                        if (tdsPujas[tdsPujas.length - 1].innerHTML == "Pendiente") {
                            var playerNameColNoScript = 0;
                            var nombreJugadorComprado = trim(tdsPujas[playerNameColNoScript].textContent).replace(/"/g, "quot").replace(/\ /g, "_");
                            if (document.getElementById("abierto") != null
                                && document.getElementById("abiertoNames") != null
                                && document.getElementById("abiertoNames").value.indexOf("//" + nombreJugadorComprado + "//") == -1) {
                                var abiertoTotal = parseInt(replaceAll(document.getElementById('abierto').value, ".", "").replace(' €', ''), 10);
                                var abiertoTD = parseInt(replaceAll(tdsPujas[precioVentaCol].innerHTML, ".", ""), 10);
                                document.getElementById('abierto').value = abiertoTotal + abiertoTD;
                                document.getElementById("abiertoNames").value += "//" + nombreJugadorComprado + "//";
                            }
                        }
                    }

                    if (text.indexOf('title="Siguiente"', pujaspos) != -1) {
                        var botonSiguientePujasPos = text.indexOf('title="Siguiente"', pujaspos);
                        while (text.charAt(--botonSiguientePujasPos) != "<");

                        var hrefSiguientePujaPos = text.indexOf('href=', botonSiguientePujasPos) + 'href="'.length;
                        var hrefSiguientePujaPosFin = text.indexOf('"', hrefSiguientePujaPos);
                        var hrefSiguientePuja = text.substring(hrefSiguientePujaPos, hrefSiguientePujaPosFin);
                        hrefSiguientePuja = replaceAll(hrefSiguientePuja, "&amp;", "&");
                        var comunio = "";
                        if (window.location.href.indexOf("https://") != -1) {
                            comunio = window.location.href.substring(0, window.location.href.indexOf("/", "https://".length));
                        } else {
                            comunio = window.location.href.substring(0, window.location.href.indexOf("/", "http://".length));
                        }
                        get(comunio + "/" + hrefSiguientePuja, getJugadoresAbiertos);
                    } else {
                        recalcularSaldo();
                        cambiarOnblurInputs();
                        if (window.location.href.indexOf("exchangemarket.phtml") != -1) {
                            get(window.location.href.replace("exchangemarket.phtml", "") + 'exchangemarket.phtml?viewoffers_x=22', getJugadoresVendidos);
                        } else if (window.location.href.indexOf("placeOffers.phtml") != -1) {
                            get(window.location.href.replace("placeOffers.phtml", "") + 'exchangemarket.phtml?viewoffers_x=22', getJugadoresVendidos);
                        }
                    }
                }
            }
        }
    }
}

if (window.location.href.indexOf("exchangemarket.phtml") != -1 && window.location.href.indexOf("?") < 0) {
    window.onload = init;
    console.log("onload HTML");
} else {
    init();
}
an